<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H∆∞·ªõng D·∫´n C·∫≠p Nh·∫≠t N·ªôi Dung - M·ª•n D·ª´a Ho√†ng Hi·∫øu</title>
    <link href="styles.css" rel="stylesheet">
</head>
<body class="font-sans pt-20 m-10">
    <!-- Header -->
    <header class="fixed top-0 left-0 w-full h-20 bg-green-50 shadow-md z-50">
        <div class="container mx-auto h-full flex items-center justify-between px-4">
            <div class="flex items-center">
                <div class="w-20 h-16 bg-cover bg-center" 
                     style="background-image: url('assets/image/logo.jpg'); background-position: top -16px left -24px;">
                </div>
                <h1 class="ml-4 text-2xl font-bold text-green-700">H∆∞·ªõng D·∫´n C·∫≠p Nh·∫≠t N·ªôi Dung</h1>
            </div>
            <nav>
                <a href="index.html" class="text-green-700 hover:text-orange-600 mx-3">Trang ch·ªß</a>
                <a href="demo-markdown-update.html" class="text-green-700 hover:text-orange-600 mx-3">Demo</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto">
        <!-- System Status -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-3xl font-bold text-green-700 mb-6 text-center">Tr·∫°ng Th√°i H·ªá Th·ªëng</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-800 mb-2">üìä Tr·∫°ng Th√°i</h3>
                    <div id="system-status" class="text-blue-700">ƒêang ki·ªÉm tra...</div>
                </div>
                
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <h3 class="font-semibold text-green-800 mb-2">‚è∞ C·∫≠p Nh·∫≠t Cu·ªëi</h3>
                    <div id="last-update" class="text-green-700">Ch∆∞a c√≥</div>
                </div>
                
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <h3 class="font-semibold text-orange-800 mb-2">üîÑ Auto-Refresh</h3>
                    <div class="text-orange-700">
                        <span id="auto-refresh-status">B·∫≠t (30s)</span>
                        <button onclick="toggleAutoRefresh()" class="ml-2 px-2 py-1 bg-orange-600 text-white text-xs rounded">
                            B·∫≠t/T·∫Øt
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex gap-2 mb-4">
                <button onclick="manualRefresh()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    üîÑ C·∫≠p Nh·∫≠t Ngay
                </button>
                <button onclick="checkStatus()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    üìä Ki·ªÉm Tra Tr·∫°ng Th√°i
                </button>
                <button onclick="testFallback()" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">
                    üß™ Test Fallback
                </button>
            </div>
        </div>

        <!-- H∆∞·ªõng D·∫´n -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-green-700 mb-6">üìö H∆∞·ªõng D·∫´n C·∫≠p Nh·∫≠t N·ªôi Dung</h2>
            
            <!-- B∆∞·ªõc 1 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-orange-600 mb-4">1Ô∏è‚É£ C√°ch C·∫≠p Nh·∫≠t Th√¥ng Tin Li√™n H·ªá</h3>
                
                <div class="bg-gray-50 border-l-4 border-orange-500 p-4 mb-4">
                    <p class="font-semibold mb-2">üìÇ File c·∫ßn ch·ªânh s·ª≠a:</p>
                    <code class="bg-gray-200 px-2 py-1 rounded">content/pages/trang-chu.md</code>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <strong>S·ªë ƒëi·ªán tho·∫°i:</strong>
                        <div class="bg-gray-100 p-3 rounded mt-1">
                            <code>üìû **Hotline**: 0984.288.512</code>
                        </div>
                    </div>
                    
                    <div>
                        <strong>Email:</strong>
                        <div class="bg-gray-100 p-3 rounded mt-1">
                            <code>üìß **Email**: munduahoanghieu.vn@gmail.com</code>
                        </div>
                    </div>
                    
                    <div>
                        <strong>ƒê·ªãa ch·ªâ:</strong>
                        <div class="bg-gray-100 p-3 rounded mt-1">
                            <code>üìç **ƒê·ªãa ch·ªâ**: ·∫§p H·ªôi An, X√£ ƒêa Ph∆∞·ªõc H·ªôi, Huy·ªán M·ªè C√†y Nam, T·ªânh B·∫øn Tre</code>
                        </div>
                    </div>
                </div>
            </div>

            <!-- B∆∞·ªõc 2 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-orange-600 mb-4">2Ô∏è‚É£ Sau Khi Ch·ªânh S·ª≠a</h3>
                
                <div class="space-y-3">
                    <div class="flex items-center space-x-2">
                        <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm">1</span>
                        <span>L∆∞u file markdown</span>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm">2</span>
                        <span>Click n√∫t <strong>"üîÑ C·∫≠p Nh·∫≠t Ngay"</strong> ·ªü tr√™n</span>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm">3</span>
                        <span>Ki·ªÉm tra footer website ƒë√£ c·∫≠p nh·∫≠t</span>
                    </div>
                </div>
            </div>

            <!-- B∆∞·ªõc 3 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-orange-600 mb-4">3Ô∏è‚É£ H·ªá Th·ªëng T·ª± ƒê·ªông</h3>
                
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <ul class="space-y-2 text-blue-800">
                        <li>‚úÖ <strong>Auto-refresh m·ªói 30 gi√¢y</strong> - Website t·ª± ƒë·ªông ki·ªÉm tra v√† c·∫≠p nh·∫≠t</li>
                        <li>‚úÖ <strong>Fallback system</strong> - N·∫øu markdown l·ªói ‚Üí d√πng JSON ‚Üí d√πng data m·∫∑c ƒë·ªãnh</li>
                        <li>‚úÖ <strong>Kh√¥ng bao gi·ªù m·∫•t n·ªôi dung</strong> - Lu√¥n c√≥ backup data</li>
                        <li>‚úÖ <strong>Error handling</strong> - X·ª≠ l√Ω l·ªói t·ª± ƒë·ªông</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- C√°c File Kh√°c -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-green-700 mb-6">üìÅ C√°c File N·ªôi Dung Kh√°c</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="border border-gray-200 rounded-lg p-4">
                    <h4 class="font-semibold text-orange-600 mb-2">S·∫£n Ph·∫©m</h4>
                    <code class="text-sm bg-gray-100 p-2 rounded block mb-2">content/data/san-pham.md</code>
                    <p class="text-sm text-gray-600">Danh s√°ch s·∫£n ph·∫©m, gi√° c·∫£, m√¥ t·∫£</p>
                </div>
                
                <div class="border border-gray-200 rounded-lg p-4">
                    <h4 class="font-semibold text-orange-600 mb-2">ƒê√°nh Gi√° Kh√°ch H√†ng</h4>
                    <code class="text-sm bg-gray-100 p-2 rounded block mb-2">content/data/chung-thuc-khach-hang.md</code>
                    <p class="text-sm text-gray-600">Testimonials, reviews t·ª´ kh√°ch h√†ng</p>
                </div>
                
                <div class="border border-gray-200 rounded-lg p-4">
                    <h4 class="font-semibold text-orange-600 mb-2">Quy Tr√¨nh S·∫£n Xu·∫•t</h4>
                    <code class="text-sm bg-gray-100 p-2 rounded block mb-2">content/data/quy-trinh-cong-nghe.md</code>
                    <p class="text-sm text-gray-600">C√°c b∆∞·ªõc s·∫£n xu·∫•t, c√¥ng ngh·ªá</p>
                </div>
                
                <div class="border border-gray-200 rounded-lg p-4">
                    <h4 class="font-semibold text-orange-600 mb-2">H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng</h4>
                    <code class="text-sm bg-gray-100 p-2 rounded block mb-2">content/data/huong-dan-su-dung.md</code>
                    <p class="text-sm text-gray-600">C√°ch s·ª≠ d·ª•ng s·∫£n ph·∫©m</p>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-green-700 mb-6">üìã Logs Ho·∫°t ƒê·ªông</h2>
            <div id="activity-logs" class="space-y-2 max-h-64 overflow-y-auto bg-gray-50 p-4 rounded">
                <!-- Logs will appear here -->
            </div>
        </div>
    </main>

    <!-- Footer hi·ªán t·∫°i -->
    <footer class="bg-green-800 text-white mt-16">
        <div class="container mx-auto px-4 py-8">
            <div class="text-center space-y-4">
                <h3 class="text-xl font-bold text-orange-400">M·ª§N D·ª™A HO√ÄNG HI·∫æU</h3>
                <div class="space-y-2 text-sm">
                    <div>üìû Hotline: <span data-contact="phone" class="text-orange-300">ƒêang t·∫£i...</span></div>
                    <div>üìß Email: <span data-contact="email" class="text-orange-300">ƒêang t·∫£i...</span></div>
                    <div>üìç <span data-contact="address" class="text-orange-300">ƒêang t·∫£i...</span></div>
                </div>
                <div class="text-xs text-gray-400">
                    Footer n√†y c·∫≠p nh·∫≠t t·ª´: <span id="footer-source">markdown</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/markdown-parser.js"></script>
    <script src="js/content-manager.js"></script>
    <script src="js/markdown-content-loader.js"></script>
    <script src="js/safe-content-manager.js"></script>
    
    <script>
        let safeManager;
        let autoRefreshInterval;
        let autoRefreshEnabled = true;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            safeManager = new SafeContentManager();
            initializeSystem();
        });

        async function initializeSystem() {
            try {
                // Initial content load
                await safeManager.updateFooterSafely();
                updateStatusDisplay();
                
                // Start auto-refresh
                startAutoRefresh();
                
                // Listen for content updates
                window.addEventListener('contentUpdate', handleContentUpdate);
                
                logActivity('‚úÖ System initialized successfully');
            } catch (error) {
                logActivity(`‚ùå System initialization failed: ${error.message}`);
            }
        }

        async function manualRefresh() {
            logActivity('üîÑ Manual refresh triggered...');
            try {
                await safeManager.forceRefresh();
                updateStatusDisplay();
                logActivity('‚úÖ Manual refresh completed');
            } catch (error) {
                logActivity(`‚ùå Manual refresh failed: ${error.message}`);
            }
        }

        async function checkStatus() {
            const status = safeManager.getUpdateStatus();
            updateStatusDisplay();
            logActivity(`üìä Status check: ${status.message}`);
        }

        async function testFallback() {
            logActivity('üß™ Testing fallback system...');
            
            // Simulate markdown failure by clearing cache and causing errors
            safeManager.clearCache();
            safeManager.cache.clear();
            
            // Try to load with broken markdown
            try {
                await safeManager.safeLoadContent('contact');
                logActivity('‚úÖ Fallback system working correctly');
            } catch (error) {
                logActivity(`‚ùå Fallback test failed: ${error.message}`);
            }
        }

        function startAutoRefresh() {
            if (autoRefreshInterval) clearInterval(autoRefreshInterval);
            
            autoRefreshInterval = setInterval(async () => {
                if (autoRefreshEnabled) {
                    await safeManager.updateFooterSafely();
                    updateStatusDisplay();
                    logActivity('üîÑ Auto-refresh completed');
                }
            }, 30000); // 30 seconds
            
            logActivity('‚ö° Auto-refresh started (30s interval)');
        }

        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const status = document.getElementById('auto-refresh-status');
            
            if (autoRefreshEnabled) {
                status.textContent = 'B·∫≠t (30s)';
                logActivity('‚ñ∂Ô∏è Auto-refresh enabled');
            } else {
                status.textContent = 'T·∫Øt';
                logActivity('‚è∏Ô∏è Auto-refresh disabled');
            }
        }

        function updateStatusDisplay() {
            const status = safeManager.getUpdateStatus();
            
            document.getElementById('system-status').textContent = status.message;
            document.getElementById('last-update').textContent = status.lastUpdate ? 
                status.lastUpdate.toLocaleTimeString() : 'Ch∆∞a c√≥';
            
            // Update footer source indicator
            const footerSource = document.getElementById('footer-source');
            switch (status.status) {
                case 'success':
                    footerSource.textContent = 'markdown ‚úÖ';
                    footerSource.className = 'text-green-400';
                    break;
                case 'json-fallback':
                    footerSource.textContent = 'JSON (fallback) ‚ö†Ô∏è';
                    footerSource.className = 'text-yellow-400';
                    break;
                case 'hardcoded-fallback':
                    footerSource.textContent = 'hardcoded (fallback) üÜò';
                    footerSource.className = 'text-red-400';
                    break;
                default:
                    footerSource.textContent = 'unknown';
                    footerSource.className = 'text-gray-400';
            }
        }

        function handleContentUpdate(event) {
            const { message, timestamp, status } = event.detail;
            updateStatusDisplay();
        }

        function logActivity(message) {
            const logs = document.getElementById('activity-logs');
            const logEntry = document.createElement('div');
            
            logEntry.className = 'text-sm p-2 bg-white rounded border-l-4 border-blue-500';
            logEntry.innerHTML = `
                <span class="text-gray-500 text-xs">${new Date().toLocaleTimeString()}</span>
                <span class="ml-2">${message}</span>
            `;
            
            logs.insertBefore(logEntry, logs.firstChild);
            
            // Keep only last 20 logs
            while (logs.children.length > 20) {
                logs.removeChild(logs.lastChild);
            }
            
            console.log(`[ContentManager] ${message}`);
        }
    </script>
</body>
</html>