{% extends 'layouts/admin.twig' %}

{% block title %}Qu·∫£n L√Ω T√†i Kho·∫£n{% endblock %}

{% block content %}
<div class="p-8">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">üë• Qu·∫£n L√Ω T√†i Kho·∫£n</h1>
    <p class="text-gray-600">Th√™m, x√≥a v√† qu·∫£n l√Ω t√†i kho·∫£n qu·∫£n tr·ªã vi√™n</p>
  </div>

  <!-- Success/Error Messages -->
  {% if success %}
    <div class="mb-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg relative">
      <span class="block sm:inline">‚úÖ {{ success }}</span>
    </div>
  {% endif %}

  {% if error %}
    <div class="mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative">
      <span class="block sm:inline">‚ùå {{ error }}</span>
    </div>
  {% endif %}

  <!-- Add New User Form -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">‚ûï Th√™m T√†i Kho·∫£n M·ªõi</h2>
    
    <form method="POST" action="/admin/users/add" class="space-y-4">
      <input type="hidden" name="_csrf" value="{{ csrfToken }}">
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
            T√™n ƒëƒÉng nh·∫≠p <span class="text-red-500">*</span>
          </label>
          <input type="text" id="username" name="username" required
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                 placeholder="admin2">
        </div>
        
        <div>
          <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
            M·∫≠t kh·∫©u <span class="text-red-500">*</span>
          </label>
          <input type="password" id="password" name="password" required minlength="6"
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                 placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±">
        </div>
        
        <div>
          <label for="role" class="block text-sm font-medium text-gray-700 mb-2">
            Vai tr√≤
          </label>
          <select id="role" name="role"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
            <option value="admin">Admin</option>
            <option value="editor">Editor</option>
          </select>
        </div>
      </div>
      
      <div>
        <button type="submit"
                class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded-lg transition-colors">
          ‚ûï Th√™m T√†i Kho·∫£n
        </button>
      </div>
    </form>
  </div>

  <!-- Users List -->
  <div class="bg-white rounded-lg shadow-md overflow-hidden">
    <div class="p-6 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-800">üìã Danh S√°ch T√†i Kho·∫£n</h2>
    </div>
    
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              T√™n ƒëƒÉng nh·∫≠p
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Vai tr√≤
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Ng√†y t·∫°o
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Tr·∫°ng th√°i
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Thao t√°c
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% for u in users %}
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="w-10 h-10 rounded-full bg-green-600 flex items-center justify-center text-white font-bold mr-3">
                  {{ u.username[0]|upper }}
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-900">{{ u.username }}</div>
                  {% if u.username == user.username %}
                    <span class="text-xs text-green-600 font-semibold">(B·∫°n)</span>
                  {% endif %}
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                           {% if u.role == 'admin' %}bg-purple-100 text-purple-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                {{ u.role|capitalize }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {% if u.createdAt %}
                {{ u.createdAt|date('d/m/Y H:i') }}
              {% else %}
                N/A
              {% endif %}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              {% if u.lockedUntil and u.lockedUntil > "now"|date("U") %}
                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                  üîí ƒê√£ kh√≥a
                </span>
              {% elseif u.failedAttempts > 0 %}
                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                  ‚ö†Ô∏è {{ u.failedAttempts }} l·∫ßn sai
                </span>
              {% else %}
                <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                  ‚úÖ Ho·∫°t ƒë·ªông
                </span>
              {% endif %}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              {% if u.username != user.username %}
                <form method="POST" action="/admin/users/delete" class="inline-block"
                      onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t√†i kho·∫£n {{ u.username }}?');">
                  <input type="hidden" name="_csrf" value="{{ csrfToken }}">
                  <input type="hidden" name="username" value="{{ u.username }}">
                  <button type="submit"
                          class="text-red-600 hover:text-red-900 font-semibold">
                    üóëÔ∏è X√≥a
                  </button>
                </form>
              {% else %}
                <span class="text-gray-400 italic">T√†i kho·∫£n hi·ªán t·∫°i</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Info Box -->
  <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-4">
    <div class="flex">
      <div class="flex-shrink-0">
        <span class="text-2xl">‚ÑπÔ∏è</span>
      </div>
      <div class="ml-3">
        <h3 class="text-sm font-semibold text-blue-800 mb-1">L∆∞u √Ω:</h3>
        <ul class="text-sm text-blue-700 space-y-1">
          <li>‚Ä¢ Kh√¥ng th·ªÉ x√≥a t√†i kho·∫£n ƒëang ƒëƒÉng nh·∫≠p</li>
          <li>‚Ä¢ T√†i kho·∫£n b·ªã kh√≥a sau 5 l·∫ßn ƒëƒÉng nh·∫≠p sai trong 30 ph√∫t</li>
          <li>‚Ä¢ M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±</li>
          <li>‚Ä¢ Vai tr√≤ "Admin" c√≥ to√†n quy·ªÅn qu·∫£n tr·ªã h·ªá th·ªëng</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
