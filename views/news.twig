{% extends 'layout.twig' %}

{% block title %}Tin Tá»©c NÃ´ng Nghiá»‡p - Má»¥n Dá»«a HoÃ ng Hiáº¿u{% endblock %}

{% block head %}
  <meta property="og:title" content="Tin Tá»©c NÃ´ng Nghiá»‡p - Má»¥n Dá»«a HoÃ ng Hiáº¿u">
  <meta property="og:description" content="Cáº­p nháº­t tin tá»©c má»›i nháº¥t vá» ká»¹ thuáº­t trá»“ng cÃ¢y vÃ  nÃ´ng nghiá»‡p bá»n vá»¯ng">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
  <link rel="stylesheet" href="/css/news.css">
{% endblock %}

{% block content %}
<!-- Top Info Bar -->
<section class="top-info-bar">
  <div class="top-info-content">
    <div class="info-item">
      <span id="top-info-time">Äang táº£i...</span>
    </div>
    <div class="info-item tip-item">
      <span class="tip-icon">ğŸ’¡</span>
      <span id="top-info-tip">Giá»¯ áº©m cho má»¥n dá»«a trÆ°á»›c khi sá»­ dá»¥ng</span>
    </div>
    <div class="info-item">
      <span id="quickNews" class="info-quick-news">Äang táº£i tin nhanh...</span>
    </div>
    <div class="info-slogan">
      ğŸ’š Äá»“ng hÃ nh cÃ¹ng nhÃ  nÃ´ng - Lan tá»a nÃ´ng nghiá»‡p xanh ğŸŒ¿
    </div>
  </div>
</section>

<!-- Hero Banner -->
<section class="hero-banner">
  <div class="swiper swiper-hero">
    <div class="swiper-wrapper">
      <div class="swiper-slide"><img src="/assets/image/News/Banner/1-dua.jpg" alt="Banner 1" style="width:100%;height:100%;object-fit:cover;"></div>
      <div class="swiper-slide"><img src="/assets/image/News/Banner/2-Dua kho.jpg" alt="Banner 2" style="width:100%;height:100%;object-fit:cover;"></div>
      <div class="swiper-slide"><img src="/assets/image/News/Banner/3-xo-dua.jpg" alt="Banner 3" style="width:100%;height:100%;object-fit:cover;"></div>
      <div class="swiper-slide"><img src="/assets/image/News/Banner/4-Xa chat.jpg" alt="Banner 4" style="width:100%;height:100%;object-fit:cover;"></div>
      <div class="swiper-slide"><img src="/assets/image/News/Banner/5-Nong trai.jpg" alt="Banner 5" style="width:100%;height:100%;object-fit:cover;"></div>
      <div class="swiper-slide"><img src="/assets/image/News/Banner/6-Mam xanh.jpg" alt="Banner 6" style="width:100%;height:100%;object-fit:cover;"></div>
    </div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  </div>
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <h1 class="hero-title">Tin Tá»©c NÃ´ng Nghiá»‡p</h1>
    <p class="hero-subtitle">Cáº­p nháº­t nhá»¯ng thÃ´ng tin má»›i nháº¥t vá» ká»¹ thuáº­t trá»“ng cÃ¢y, chÄƒm sÃ³c vÆ°á»n, vÃ  cÃ¡c giáº£i phÃ¡p nÃ´ng nghiá»‡p bá»n vá»¯ng vá»›i má»¥n dá»«a.</p>
    <button class="hero-btn" onclick="document.querySelector('.main-container').scrollIntoView({behavior:'smooth'})">
      <span>ğŸ“–</span>
      <span>Äá»c Ngay</span>
    </button>
  </div>
</section>

<!-- Full-width Category Menu Bar -->
<nav class="category-bar">
  <div class="category-bar-inner">
    <button class="cat-btn category-tag active" data-category="all">ğŸ—‚ï¸ Táº¥t Cáº£</button>
    <button class="cat-btn category-tag" data-category="knowledge">ğŸŒ¾ Kiáº¿n Thá»©c CÆ¡ Báº£n</button>
    <button class="cat-btn category-tag"
    data-category="techniques">ğŸŒ± Ká»¹ Thuáº­t Canh TÃ¡c</button>
    <button class="cat-btn category-tag" data-category="experience">ğŸ’¡ Kinh Nghiá»‡m NÃ´ng DÃ¢n</button>
    <button class="cat-btn category-tag" data-category="benefits">ğŸŒ Lá»£i Ãch & MÃ´i TrÆ°á»ng</button>
    <button class="cat-btn category-tag" data-category="other">ğŸ“‚ KhÃ¡c</button>
    </div>
</nav>

<!-- Main Content Container -->
<div class="main-container py-12 lg:py-16">
  <div class="grid grid-cols-1 gap-y-6 lg:grid-cols-12 lg:gap-x-4 lg:gap-y-4 lg:px-[3%]">
    
    <!-- Left Sidebar: Production Process + Newsletter (2 columns) -->
  <aside class="left-sidebar col-span-12 lg:col-span-2 flex flex-col gap-4">
      <!-- Production Process -->
  <div class="process-card w-full bg-green-50 rounded-xl shadow-sm p-4">
        <h3 class="process-title">
          <span>ğŸ¬</span>
          <span>TÃ³m LÆ°á»£c Quy TrÃ¬nh Sáº£n Xuáº¥t</span>
        </h3>
        <div class="process-grid">
          <div class="process-step" onclick="window.open('/assets/image/News/Left side/3-Tach xo nghien mun.mp4','_blank')">
            <img src="/assets/image/News/Left side/3p-Tach xo.jpg" alt="TÃ¡ch xÆ¡ nghiá»n">
            <div class="process-step-label">TÃ¡ch xÆ¡<br>Nghiá»n má»¥n</div>
          </div>
          <div class="process-step" onclick="window.open('/assets/image/News/Left side/4-Xa chat.mp4','_blank')">
            <img src="/assets/image/News/Left side/4p-Xa chat.jpg" alt="Xáº£ cháº¥t">
            <div class="process-step-label">Xáº£ chÃ¡t</div>
          </div>
          <div class="process-step" onclick="window.open('/assets/image/News/Left side/5-U sinh hoc.mp4','_blank')">
            <img src="/assets/image/News/Left side/5p-U sinh hoc.jpg" alt="á»¦ sinh há»c">
            <div class="process-step-label">á»¦ sinh há»c</div>
          </div>
          <div class="process-step" onclick="window.open('/assets/image/News/Left side/6-Bang tai ep.mp4','_blank')">
            <img src="/assets/image/News/Left side/6p-Luu kho.jpg" alt="BÄƒng táº£i Ã©p">
            <div class="process-step-label">BÄƒng táº£i Ã©p<br>ÄÃ³ng gÃ³i</div>
          </div>
        </div>
      </div>
      
      <!-- Newsletter Signup -->
  <div class="newsletter-card w-full bg-green-50 rounded-xl shadow-sm p-4">
        <h3 class="newsletter-title">ğŸ“§ ÄÄƒng kÃ½ nháº­n tin</h3>
        <p style="font-size: 0.85rem; color: #374151; margin-bottom: 0.75rem; line-height: 1.5;">Cáº­p nháº­t máº¹o trá»“ng & Æ°u Ä‘Ã£i má»›i nháº¥t</p>
        <input type="email" class="newsletter-input" placeholder="Email cá»§a báº¡n" id="newsletter-email">
        <button class="newsletter-btn" onclick="subscribeNewsletter()">ÄÄƒng kÃ½ ngay</button>
      </div>
    </aside>
    
    <!-- Center Content: News List / Detail View (6 columns) -->
    <div class="center-content col-span-12 lg:col-span-6 flex flex-col gap-4">
      <!-- News Highlight View -->
      <div class="news-highlight" id="news-highlight">
        <div class="flex justify-between items-center mb-4">
          <h2 class="news-highlight-title" id="news-highlight-title">
            <span>â­</span>
            <span id="news-highlight-label">Tin Má»›i Nháº¥t</span>
          </h2>
          <a href="#" onclick="filterByCategory('all'); document.querySelector('.news-list-view').scrollIntoView({behavior:'smooth',block:'start'}); return false;" class="text-sm text-green-600 hover:text-green-800 hover:underline transition-all duration-200">Xem táº¥t cáº£ â†’</a>
        </div>
        <div class="news-highlight-grid" id="news-highlight-grid">
          <!-- Top three news cards rendered by JS -->
        </div>
      </div>

      <!-- News List View -->
      <div class="news-list-view visible" id="news-list-view">
        <h2 class="news-list-title" id="news-section-title">ğŸ“š Táº¥t Cáº£ BÃ i Viáº¿t</h2>
        <div class="news-list-grid" id="news-list-grid">
          <!-- News cards will be rendered here by JS -->
        </div>
      </div>
      
      <!-- News Detail View (Hidden by default) -->
      <div class="news-detail-view hidden" id="news-detail-view">
        <div class="post-detail">
          <!-- Top Back Button (Left aligned) -->
          <div class="flex items-center justify-between mb-6">
            <button class="back-btn" onclick="closePostDetailNew()">
              <span>â†</span>
              <span>Quay láº¡i danh sÃ¡ch</span>
            </button>
          </div>
          
          <article class="prose max-w-none">
            <h1 class="post-detail-title" id="post-title-new"></h1>
            <div class="post-detail-meta" id="post-meta-new">
              <span id="post-date-new"></span>
              <span id="post-category-new"></span>
              <span id="post-views-new"></span>
            </div>
            <div class="post-detail-content" id="post-content-new">
              <!-- Full post content will be rendered here -->
            </div>
            <div class="post-gallery" id="post-gallery"></div>
          </article>
          
          <!-- Interaction Buttons -->
          <div class="interaction-bar">
            <button class="interaction-btn" id="btn-useful-new" onclick="markUseful()" style="background: #16a34a; color: white; border-color: #15803d;">
              <span>ğŸ‘</span>
              <span>Há»¯u Ã­ch</span>
            </button>
            <button class="interaction-btn" id="btn-save-new" onclick="savePost()">
              <span>ğŸ’¾</span>
              <span>LÆ°u</span>
            </button>
            <div class="share-group">
              <span class="share-label">Chia sáº»</span>
              <button class="interaction-btn share-btn" onclick="shareZalo()" style="background: #0068ff; color: white; border-color: #0052cc;">
                <span style="font-size: 1.5rem; font-weight: bold;">Z</span>
              </button>
              <button class="interaction-btn share-btn" onclick="shareFacebook()" style="background: #1877f2; color: white; border-color: #166fe5;">
                <span style="font-size: 1.5rem;">f</span>
              </button>
              <button class="interaction-btn share-btn" onclick="copyLink()" style="background: #16a34a; color: white; border-color: #15803d;">
                <span style="font-size: 1.25rem;">ğŸ”—</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Tip Sidebar: Máº¹o Canh TÃ¡c + BÃ i Viáº¿t LiÃªn Quan (2 columns) -->
    <aside class="tip-sidebar col-span-12 lg:col-span-2 flex flex-col gap-4" id="tip-sidebar">
      <!-- Máº¹o Canh TÃ¡c -->
      <div class="tip-card w-full" id="tip-card">
        <h3 class="tip-title">
          <span>ğŸ’¡</span>
          <span>Máº¹o Canh TÃ¡c</span>
        </h3>
        <div class="tip-content" id="daily-tip-content">
          Äang táº£i máº¹o canh tÃ¡c...
        </div>
        <div class="tip-nav">
          <button class="tip-nav-btn" onclick="previousTip()">â† TrÆ°á»›c</button>
          <button class="tip-nav-btn" onclick="nextTip()">Sau â†’</button>
        </div>
      </div>
      
      <!-- BÃ i Viáº¿t LiÃªn Quan (moved here from results) -->
      <div class="related-card w-full">
        <h3 class="related-title">
          <span>ğŸ“°</span>
          <span>BÃ i Viáº¿t LiÃªn Quan</span>
        </h3>
        <div class="related-list" id="related-posts-list">
          <!-- Related posts rendered by JS -->
        </div>
      </div>
    </aside>
    
    <!-- Results Sidebar: Farm Gallery + Contact (2 columns) -->
    <aside class="results-sidebar col-span-12 lg:col-span-2 flex flex-col gap-4">
      <!-- Farm Results Gallery -->
      <div class="results-card w-full bg-green-50 rounded-xl shadow-sm p-4">
        <h3 class="results-title">
          <span>ğŸ“¸</span>
          <span>GÃ³c Chia Sáº»</span>
        </h3>
        <div class="results-grid share-gallery" id="results-gallery">
          <!-- Fallback images - will be replaced by JS -->
          <img src="/assets/image/gallery/results/cÃ  chua 1.jpg" alt="Káº¿t quáº£ 1" class="result-img fade-in" onerror="this.style.display='none'">
          <img src="/assets/image/gallery/results/CÃ  chua.png" alt="Káº¿t quáº£ 2" class="result-img fade-in" onerror="this.style.display='none'">
          <img src="/assets/image/gallery/results/dÃ¢u tÃ¢y.png" alt="Káº¿t quáº£ 3" class="result-img fade-in" onerror="this.style.display='none'">
          <img src="/assets/image/gallery/results/dÆ°a lÆ°á»›i.png" alt="Káº¿t quáº£ 4" class="result-img fade-in" onerror="this.style.display='none'">
        </div>
      </div>
      
      <!-- Quick Contact -->
      <div class="contact-card w-full bg-green-50 rounded-xl shadow-sm p-4">
        <h3 class="contact-title">ğŸ“ LiÃªn Há»‡ Nhanh</h3>
        <button class="contact-btn" onclick="window.open('https://zalo.me/112949426040780264','_blank')" style="background: #0068FF; color: white; padding: 0.75rem 1rem;">
          <img src="/assets/image/Footer/zalo.png" alt="Zalo" style="width: 24px; height: 24px; flex-shrink: 0; border-radius: 4px;">
          <span style="font-weight: 600;">Chat Zalo</span>
        </button>
        <button class="contact-btn" onclick="window.location.href='tel:0984288512'" style="background: #16a34a; color: white; padding: 0.75rem 1rem;">
          <span style="font-size: 1.25rem;">ğŸ“±</span>
          <span style="font-weight: 600;">0984.288.512</span>
        </button>
      </div>
    </aside>
    
  </div>
</div>
{% endblock %}

{% block scripts %}
{% if quickNewsData is defined %}
<script>
  try {
    window.__QUICK_NEWS__ = {{ quickNewsData|raw }};
  } catch (e) {
    console.warn('Error parsing quickNewsData', e);
    window.__QUICK_NEWS__ = null;
  }
</script>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
// ============ Time Display ============
function updateTopInfoTime() {
  const el = document.getElementById('top-info-time');
  if (!el) return;
  const now = new Date();
  const days = ['Chá»§ Nháº­t', 'Thá»© Hai', 'Thá»© Ba', 'Thá»© TÆ°', 'Thá»© NÄƒm', 'Thá»© SÃ¡u', 'Thá»© Báº£y'];
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const day = now.getDate();
  const month = now.getMonth() + 1;
  const year = now.getFullYear();
  el.textContent = `${hours}:${minutes} ${days[now.getDay()]}, ${day}/${month}/${year}`;
}

// ============ Tip Rotation ============
const tips = [
  'Giá»¯ áº©m cho má»¥n dá»«a trÆ°á»›c khi sá»­ dá»¥ng',
  'Xáº£ muá»‘i ká»¹ trÆ°á»›c khi trá»“ng',
  'Phá»‘i trá»™n Ä‘Ãºng tá»‰ lá»‡ theo loáº¡i cÃ¢y',
  'Bá»• sung phÃ¢n bÃ³n Ä‘á»‹nh ká»³',
  'Kiá»ƒm tra pH thÆ°á»ng xuyÃªn'
];
let currentTipIndex = 0;

function rotateTip() {
  const el = document.getElementById('top-info-tip');
  if (!el) return;
  currentTipIndex = (currentTipIndex + 1) % tips.length;
  el.classList.add('quick-fade-out');
  setTimeout(()=>{
    el.textContent = tips[currentTipIndex];
    el.classList.remove('quick-fade-out');
    el.classList.add('quick-fade-in');
    setTimeout(()=>el.classList.remove('quick-fade-in'), 220);
  }, 220);
}

// ============ Daily Tip (Máº¹o canh tÃ¡c) ============
const dailyTips = [
  'Giá»¯ Ä‘á»™ áº©m á»•n Ä‘á»‹nh cho má»¥n dá»«a báº±ng cÃ¡ch phun sÆ°Æ¡ng nháº¹ hÃ ng ngÃ y. Äá»™ áº©m lÃ½ tÆ°á»Ÿng giÃºp rá»… cÃ¢y phÃ¡t triá»ƒn máº¡nh máº½.',
  'Khi sá»­ dá»¥ng má»¥n dá»«a láº§n Ä‘áº§u, ngÃ¢m trong nÆ°á»›c sáº¡ch 30 phÃºt Ä‘á»ƒ loáº¡i bá» muá»‘i dÆ° thá»«a vÃ  táº¡p cháº¥t.',
  'Trá»™n má»¥n dá»«a vá»›i Ä‘áº¥t vÆ°á»n theo tá»‰ lá»‡ 3:1 cho cÃ¢y trá»“ng trong cháº­u Ä‘á»ƒ Ä‘áº£m báº£o thoÃ¡t nÆ°á»›c tá»‘t.',
  'Bá»• sung phÃ¢n bÃ³n há»¯u cÆ¡ má»—i 2 tuáº§n má»™t láº§n Ä‘á»ƒ cung cáº¥p dinh dÆ°á»¡ng cho cÃ¢y trá»“ng trÃªn má»¥n dá»«a.',
  'Kiá»ƒm tra pH cá»§a má»¥n dá»«a Ä‘á»‹nh ká»³. pH lÃ½ tÆ°á»Ÿng nÃªn trong khoáº£ng 5.5-6.5 cho háº§u háº¿t cÃ¡c loáº¡i cÃ¢y.',
  'TrÃ¡nh Ä‘á»ƒ má»¥n dá»«a khÃ´ hoÃ n toÃ n. LuÃ´n duy trÃ¬ Ä‘á»™ áº©m vá»«a pháº£i Ä‘á»ƒ cÃ¢y háº¥p thá»¥ nÆ°á»›c vÃ  dinh dÆ°á»¡ng hiá»‡u quáº£.'
];
let currentDailyTipIndex = 0;

function showDailyTip() {
  const el = document.getElementById('daily-tip-content');
  if (!el) return;
  el.textContent = dailyTips[currentDailyTipIndex];
}

function nextTip() {
  currentDailyTipIndex = (currentDailyTipIndex + 1) % dailyTips.length;
  showDailyTip();
}

function previousTip() {
  currentDailyTipIndex = (currentDailyTipIndex - 1 + dailyTips.length) % dailyTips.length;
  showDailyTip();
}

// ============ Quick News Rotation ============
function initQuickNewsRotator() {
  const el = document.getElementById('quickNews');
  if(!el) return;
  let list = window.__QUICK_NEWS__||[];
  if(!list.length){ el.textContent='ChÆ°a cÃ³ tin nhanh'; return; }
  let idx=-1; 
  const next = ()=>{ 
    idx=(idx+1)%list.length; 
    el.classList.add('quick-fade-out');
    setTimeout(()=>{
      el.textContent = list[idx]; 
      el.classList.remove('quick-fade-out');
      el.classList.add('quick-fade-in');
      setTimeout(()=>el.classList.remove('quick-fade-in'), 220);
    }, 220);
  }; 
  next(); 
  setInterval(next,4000);
}

// ============ Banner Slider ============
function initBannerSlider(){
  if(typeof Swiper==='undefined') return;
  try{
    new Swiper('.swiper-hero', {
      loop:true,
      speed:800,
      effect:'fade',
      autoplay:{delay:5000,disableOnInteraction:false,pauseOnMouseEnter:true},
      navigation:{nextEl:'.swiper-button-next',prevEl:'.swiper-button-prev'},
      pagination:{el:'.swiper-pagination',clickable:true},
      keyboard:{enabled:true}
    });
  }catch(e){console.warn('Swiper init failed',e);}
}

// ============ Mock News Data ============
const mockNewsData = [
  {
    id: 1,
    title: 'LÃ m tháº¿ nÃ o Ä‘á»ƒ phÃ¢n biá»‡t má»¥n dá»«a Ä‘Ã£ xá»­ lÃ½ vÃ  má»¥n dá»«a chÆ°a xá»­ lÃ½',
    excerpt: 'HÆ°á»›ng dáº«n chi tiáº¿t cÃ¡ch nháº­n biáº¿t má»¥n dá»«a Ä‘Ã£ qua xá»­ lÃ½ Ä‘á»ƒ Ä‘áº£m báº£o cháº¥t lÆ°á»£ng cho cÃ¢y trá»“ng...',
    category: 'techniques',
    categoryName: 'Ká»¹ Thuáº­t',
    categories: ['knowledge', 'techniques'],  // Kiáº¿n Thá»©c CÆ¡ Báº£n vÃ  Ká»¹ Thuáº­t
    date: '23/10/2025',
    views: 0, // Will be updated from API
    cover: '/assets/image/News/1.1-Mun%20da%20xu%20ly.jpg',
    images: [
      '/assets/image/News/1.1-Mun%20da%20xu%20ly.jpg',
      '/assets/image/News/1.2-Mun%20chua%20xu%20ly.jpg'
    ],
    content: `
      <h3 class="text-3xl font-bold text-green-700 mb-6">PhÃ¢n Biá»‡t Má»¥n Dá»«a Xá»­ LÃ½ & ChÆ°a Xá»­ LÃ½</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-6 shadow-lg">
          <div class="text-center mb-4">
            <span class="inline-block px-4 py-2 bg-orange-600 text-white rounded-full font-bold text-lg">âœ… Má»¥n ÄÃ£ Xá»­ LÃ½</span>
          </div>
          <img src="/assets/image/News/1.1-Mun da xu ly.jpg" alt="Má»¥n Ä‘Ã£ xá»­ lÃ½" class="w-full rounded-lg shadow-md mb-4 hover:scale-105 transition-transform duration-300">
          <div class="space-y-3 text-gray-800">
            <div class="flex items-start gap-3">
              <span class="text-2xl">ğŸ¨</span>
              <div>
                <strong class="text-orange-700">MÃ u sáº¯c:</strong> NÃ‚U Äá» Ä‘áº·c trÆ°ng
              </div>
            </div>
            <div class="flex items-start gap-3">
              <span class="text-2xl">ğŸ‘‹</span>
              <div>
                <strong class="text-orange-700">Cáº£m quan:</strong> Má»€M Má»ŠN, áº¨M Æ¯á»šT
              </div>
            </div>
            <div class="flex items-start gap-3">
              <span class="text-2xl">ğŸ’§</span>
              <div>
                <strong class="text-orange-700">Giá»¯ nÆ°á»›c:</strong> NgÃ¢m nÆ°á»›c cÃ³ mÃ u NHáº T/TRONG SUá»T
              </div>
            </div>
          </div>
        </div>

        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-6 shadow-lg">
          <div class="text-center mb-4">
            <span class="inline-block px-4 py-2 bg-yellow-600 text-white rounded-full font-bold text-lg">âš ï¸ Má»¥n ChÆ°a Xá»­ LÃ½</span>
          </div>
          <img src="/assets/image/News/1.2-Mun chua xu ly.jpg" alt="Má»¥n chÆ°a xá»­ lÃ½" class="w-full rounded-lg shadow-md mb-4 hover:scale-105 transition-transform duration-300">
          <div class="space-y-3 text-gray-800">
            <div class="flex items-start gap-3">
              <span class="text-2xl">ğŸ¨</span>
              <div>
                <strong class="text-yellow-700">MÃ u sáº¯c:</strong> VÃ€NG NHáº T
              </div>
            </div>
            <div class="flex items-start gap-3">
              <span class="text-2xl">ğŸ‘‹</span>
              <div>
                <strong class="text-yellow-700">Cáº£m quan:</strong> Cá»¨NG, KHÃ” RÃO
              </div>
            </div>
            <div class="flex items-start gap-3">
              <span class="text-2xl">ğŸ’§</span>
              <div>
                <strong class="text-yellow-700">Giá»¯ nÆ°á»›c:</strong> NgÃ¢m nÆ°á»›c cÃ³ mÃ u NÃ‚U Sáº¬M
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg mb-6">
        <h4 class="text-xl font-bold text-blue-700 mb-4 flex items-center gap-2">
          <span class="text-2xl">ğŸ”¬</span> Kiá»ƒm Tra Äá»‹nh LÆ°á»£ng (Äá»™ ChÃ­nh XÃ¡c Cao)
        </h4>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-white p-4 rounded-lg shadow">
            <div class="text-center mb-2 text-3xl">ğŸ’¦</div>
            <h5 class="font-semibold text-center mb-2">Äá»™ áº¨m</h5>
            <p class="text-sm text-center">
              <span class="text-green-600 font-bold">Xá»­ lÃ½: 70-80%</span><br>
              <span class="text-gray-600">ChÆ°a xá»­ lÃ½: 45-55%</span>
            </p>
          </div>
          <div class="bg-white p-4 rounded-lg shadow">
            <div class="text-center mb-2 text-3xl">âš¡</div>
            <h5 class="font-semibold text-center mb-2">Äá»™ Dáº«n Äiá»‡n</h5>
            <p class="text-sm text-center">
              <span class="text-green-600 font-bold">Xá»­ lÃ½: â‰¤ 0.5</span><br>
              <span class="text-gray-600">ChÆ°a xá»­ lÃ½: > 2.5</span>
            </p>
          </div>
          <div class="bg-white p-4 rounded-lg shadow">
            <div class="text-center mb-2 text-3xl">ğŸ§ª</div>
            <h5 class="font-semibold text-center mb-2">Äá»™ pH</h5>
            <p class="text-sm text-center">
              <span class="text-green-600 font-bold">Xá»­ lÃ½: 6-7</span><br>
              <span class="text-gray-600">ChÆ°a xá»­ lÃ½: 5.5-6.5</span>
            </p>
          </div>
        </div>
      </div>

      <div class="bg-green-50 rounded-lg p-6">
        <p class="text-lg text-gray-700 leading-relaxed">
          <strong class="text-green-700">ğŸ’¡ LÆ°u Ã½:</strong> Viá»‡c phÃ¢n biá»‡t Ä‘Ãºng loáº¡i má»¥n dá»«a giÃºp báº¡n lá»±a chá»n sáº£n pháº©m phÃ¹ há»£p 
          cho tá»«ng loáº¡i cÃ¢y trá»“ng, Ä‘áº£m báº£o hiá»‡u quáº£ canh tÃ¡c tá»‘t nháº¥t vÃ  trÃ¡nh gÃ¢y háº¡i cho cÃ¢y.
        </p>
      </div>
    `
  },
  {
    id: 2,
    title: 'Nhá»¯ng tÃ¡c dá»¥ng cá»§a xÆ¡ dá»«a Ä‘á»‘i vá»›i cÃ¢y trá»“ng',
    excerpt: 'XÆ¡ dá»«a khÃ´ng chá»‰ giÃºp giá»¯ áº©m mÃ  cÃ²n cáº£i thiá»‡n cáº¥u trÃºc Ä‘áº¥t, tÄƒng cÆ°á»ng há»‡ vi sinh...',
    category: 'benefits',
    categoryName: 'Lá»£i Ãch & MÃ´i TrÆ°á»ng',
    categories: ['benefits', 'techniques'],  // Lá»£i Ãch & MÃ´i TrÆ°á»ng, Ká»¹ Thuáº­t
    date: '22/10/2025',
    views: 980,
    cover: '/assets/image/News/2.2-Tac%20dung%20cua%20xo%20dua.jpg',
    images: [
      '/assets/image/News/2.2-Tac%20dung%20cua%20xo%20dua.jpg'
    ],
    content: `
      <h2>Lá»£i Ã­ch ná»•i báº­t</h2>
      <p>XÆ¡ dá»«a giá»¯ áº©m tá»‘t, giÃºp bá»™ rá»… khÃ´ng bá»‹ sá»‘c nhiá»‡t khi thá»i tiáº¿t thay Ä‘á»•i. CÃ¡c sá»£i lignin táº¡o ra Ä‘á»™ thÃ´ng thoÃ¡ng, háº¡n cháº¿ Ãºng rá»….</p>
      <p>Trong canh tÃ¡c há»¯u cÆ¡, xÆ¡ dá»«a lÃ  váº­t liá»‡u há»— trá»£ tuyá»‡t vá»i Ä‘á»ƒ phá»‘i trá»™n vá»›i phÃ¢n trÃ¹n quáº¿, phÃ¢n chuá»“ng hoai má»¥c.</p>
      <h2>CÃ¡ch á»©ng dá»¥ng hiá»‡u quáº£</h2>
      <ul>
        <li>Phá»‘i trá»™n xÆ¡ dá»«a vá»›i Ä‘áº¥t theo tá»· lá»‡ 30-40% cho cÃ¢y trá»“ng cháº­u.</li>
        <li>DÃ¹ng xÆ¡ dá»«a phá»§ gá»‘c Ä‘á»ƒ giá»¯ áº©m vÃ  háº¡n cháº¿ cá» dáº¡i.</li>
        <li>á»¦ xÆ¡ dá»«a vá»›i cháº¿ pháº©m vi sinh Ä‘á»ƒ tÄƒng hÃ m lÆ°á»£ng dinh dÆ°á»¡ng.</li>
      </ul>
    `
  },
  {
    id: 3,
    title: 'Má»™t sá»‘ lÆ°u Ã½ khi sá»­ dá»¥ng má»¥n dá»«a',
    excerpt: 'Äá»ƒ tá»‘i Æ°u hiá»‡u quáº£ sá»­ dá»¥ng má»¥n dá»«a, báº¡n cáº§n chÃº Ã½ Ä‘áº¿n Ä‘á»™ áº©m, pH, vÃ  cÃ¡ch trá»™n phá»‘i...',
    category: 'techniques',
    categoryName: 'Ká»¹ Thuáº­t',
    categories: ['knowledge', 'techniques', 'experience'],  // Kiáº¿n Thá»©c, Ká»¹ Thuáº­t vÃ  Kinh Nghiá»‡m
    date: '21/10/2025',
    views: 1100,
    cover: '/assets/image/News/3.1-Luu%20y.jpg',
    images: [
      '/assets/image/News/3.1-Luu%20y.jpg',
      '/assets/image/News/3.2-Luu%20y.jpg',
      '/assets/image/News/3.3-Luu%20y.jpg'
    ],
    content: `
      <h2>Äá»™ áº©m vÃ  thoÃ¡t nÆ°á»›c</h2>
      <p>LuÃ´n duy trÃ¬ Ä‘á»™ áº©m cá»§a má»¥n dá»«a khoáº£ng 60-70%. Náº¿u quÃ¡ khÃ´, rá»… sáº½ khÃ³ hÃºt nÆ°á»›c; náº¿u quÃ¡ Æ°á»›t, dá»… phÃ¡t sinh náº¥m bá»‡nh.</p>
      <h2>Äiá»u chá»‰nh pH</h2>
      <p>Kiá»ƒm tra pH Ä‘á»‹nh ká»³ vÃ  bá»• sung vÃ´i dolomite khi pH xuá»‘ng dÆ°á»›i 5.5. Äiá»u nÃ y giÃºp rá»… háº¥p thá»¥ dinh dÆ°á»¡ng tá»‘i Æ°u.</p>
      <h2>Phá»‘i trá»™n dinh dÆ°á»¡ng</h2>
      <p>Káº¿t há»£p má»¥n dá»«a vá»›i phÃ¢n compost, phÃ¢n há»¯u cÆ¡ hoáº·c phÃ¢n tan cháº­m Ä‘á»ƒ cung cáº¥p dinh dÆ°á»¡ng bá»n vá»¯ng cho cÃ¢y.</p>
    `
  },
  {
    id: 4,
    title: 'Má»¥n dá»«a lÃ  gÃ¬ vÃ  táº¡i sao Ä‘Æ°á»£c sá»­ dá»¥ng trong trá»“ng cÃ¢y',
    excerpt: 'TÃ¬m hiá»ƒu vá» nguá»“n gá»‘c, Ä‘áº·c tÃ­nh vÃ  á»©ng dá»¥ng cá»§a má»¥n dá»«a trong nÃ´ng nghiá»‡p hiá»‡n Ä‘áº¡i...',
    category: 'knowledge',
    categoryName: 'Kiáº¿n Thá»©c CÆ¡ Báº£n',
    categories: ['knowledge', 'benefits'],  // Kiáº¿n Thá»©c CÆ¡ Báº£n vÃ  Lá»£i Ãch & MÃ´i TrÆ°á»ng
    date: '20/10/2025',
    views: 1450,
    cover: '/assets/image/News/4-1-Mua%20dua%20co%20tac%20dung%20gi.jpg',
    images: [
      '/assets/image/News/4-1-Mua%20dua%20co%20tac%20dung%20gi.jpg',
      '/assets/image/News/4.2-Mua%20dua%20co%20tac%20dung%20gi.jpg'
    ],
    content: `
      <h2>Nguá»“n gá»‘c</h2>
      <p>Má»¥n dá»«a Ä‘Æ°á»£c tÃ¡ch ra trong quÃ¡ trÃ¬nh sÆ¡ cháº¿ vá» dá»«a. Thay vÃ¬ bá» Ä‘i, pháº§n phá»¥ pháº©m nÃ y Ä‘Æ°á»£c xá»­ lÃ½ thÃ nh giÃ¡ thá»ƒ há»¯u Ã­ch.</p>
      <h2>Æ¯u Ä‘iá»ƒm vÆ°á»£t trá»™i</h2>
      <ul>
        <li>Giá»¯ áº©m tá»‘t nhÆ°ng váº«n thÃ´ng thoÃ¡ng, giÃºp rá»… phÃ¡t triá»ƒn máº¡nh.</li>
        <li>ThÃ¢n thiá»‡n mÃ´i trÆ°á»ng vÃ¬ tÃ¡i sá»­ dá»¥ng phá»¥ pháº©m nÃ´ng nghiá»‡p.</li>
        <li>Dá»… phá»‘i trá»™n cÃ¹ng cÃ¡c váº­t liá»‡u há»¯u cÆ¡ khÃ¡c Ä‘á»ƒ táº¡o giÃ¡ thá»ƒ theo nhu cáº§u.</li>
      </ul>
      <p>Nhá» nhá»¯ng Æ°u Ä‘iá»ƒm nÃ y, má»¥n dá»«a Ä‘Æ°á»£c á»©ng dá»¥ng rá»™ng rÃ£i trong trá»“ng rau sáº¡ch, hoa kiá»ƒng vÃ  nÃ´ng nghiá»‡p cÃ´ng nghá»‡ cao.</p>
    `
  },
  {
    id: 5,
    title: 'Nhá»¯ng lá»£i Ã­ch cá»§a má»¥n dá»«a cho cÃ¢y trá»“ng vÃ  mÃ´i trÆ°á»ng',
    excerpt: 'Má»¥n dá»«a khÃ´ng chá»‰ tá»‘t cho cÃ¢y trá»“ng mÃ  cÃ²n gÃ³p pháº§n báº£o vá»‡ mÃ´i trÆ°á»ng bá»n vá»¯ng...',
    category: 'benefits',
    categoryName: 'Lá»£i Ãch & MÃ´i TrÆ°á»ng',
    categories: ['benefits', 'experience'],  // Lá»£i Ãch & MÃ´i TrÆ°á»ng vÃ  Kinh Nghiá»‡m
    date: '19/10/2025',
    views: 890,
    cover: '/assets/image/News/5-1-.jpg',
    images: [
      '/assets/image/News/5-1-.jpg'
    ],
    content: `
      <h2>Lá»£i Ã­ch cho cÃ¢y trá»“ng</h2>
      <p>Má»¥n dá»«a táº¡o mÃ´i trÆ°á»ng thoÃ¡ng khÃ­, giÃ u há»¯u cÆ¡, giÃºp bá»™ rá»… khá»e máº¡nh vÃ  chá»‘ng chá»‹u sÃ¢u bá»‡nh tá»‘t hÆ¡n.</p>
      <h2>Báº£o vá»‡ mÃ´i trÆ°á»ng</h2>
      <p>Viá»‡c tÃ¡i cháº¿ vá» dá»«a thÃ nh giÃ¡ thá»ƒ giÃºp giáº£m lÆ°á»£ng cháº¥t tháº£i nÃ´ng nghiá»‡p, gÃ³p pháº§n giáº£m Ã´ nhiá»…m Ä‘áº¥t vÃ  nÆ°á»›c.</p>
      <p>Khi káº¿t há»£p vá»›i canh tÃ¡c há»¯u cÆ¡, má»¥n dá»«a giÃºp xÃ¢y dá»±ng há»‡ sinh thÃ¡i nÃ´ng nghiá»‡p bá»n vá»¯ng.</p>
    `
  }
];

let filteredNews = [...mockNewsData];
let currentCategory = 'all';
let currentHighlightIds = [];

// ============ Render News List ============
function renderNewsList() {
  const container = document.getElementById('news-list-grid');
  if (!container) return;
  
  // Load latest views from localStorage
  loadAllViewsFromLocalStorage();
  
  if (filteredNews.length === 0) {
    container.innerHTML = '<p style="text-align:center;color:#9ca3af;padding:2rem;">KhÃ´ng cÃ³ bÃ i viáº¿t nÃ o trong danh má»¥c nÃ y.</p>';
    return;
  }
  
  container.innerHTML = filteredNews.map(post => `
    <div class="news-list-card" onclick="showPostDetailNew(${post.id})">
      <img src="${post.cover}" alt="${post.title}" class="news-list-card-img" onerror="this.src='/assets/image/placeholder.jpg'">
      <div class="news-list-card-content">
        <h3 class="news-list-card-title">${post.title}</h3>
        <p class="news-list-card-excerpt">${post.excerpt}</p>
        <div class="news-list-card-meta">
          <span>ğŸ“… ${post.date}</span>
          <span>ğŸ‘ï¸ ${post.views} lÆ°á»£t xem</span>
          <span>ğŸ“ ${post.categoryName}</span>
        </div>
      </div>
    </div>
  `).join('');
}

// ============ Render Functions (old - kept for compatibility) ============
function renderNewestPosts() {
  const container = document.getElementById('news-highlight-grid');
  if (!container) return;
  
  // Load latest views from localStorage
  loadAllViewsFromLocalStorage();
  
  // Always show top 3 from ALL news, regardless of category filter
  const allNews = mockNewsData;
  if (!allNews.length) {
    container.innerHTML = '<p style="text-align:center;color:#9ca3af;padding:1.5rem;">ChÆ°a cÃ³ bÃ i viáº¿t ná»•i báº­t.</p>';
    return;
  }

  const newest = allNews.slice(0, 3);
  currentHighlightIds = newest.map(post => post.id);
  container.innerHTML = newest.map(post => `
    <div class="news-highlight-card" onclick="showPostDetailNew(${post.id})">
      <div class="news-highlight-thumb">
        <img src="${post.cover}" alt="${post.title}" onerror="this.src='/assets/image/placeholder.jpg'">
      </div>
      <div class="news-highlight-body">
        <div class="news-highlight-meta">
          <span>ğŸ“… ${post.date}</span>
          <span>ğŸ“ ${post.categoryName}</span>
        </div>
        <h3>${post.title}</h3>
        <p class="news-highlight-excerpt">${post.excerpt}</p>
        <div class="news-highlight-meta">
          <span>ğŸ‘ï¸ ${post.views} lÆ°á»£t xem</span>
        </div>
      </div>
    </div>
  `).join('');
}

function renderCategoryPosts() {
  const container = document.getElementById('category-posts-grid');
  if (!container) return;
  
  // Load latest views from localStorage
  loadAllViewsFromLocalStorage();
  
  if (filteredNews.length === 0) {
    container.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#9ca3af;padding:2rem;">KhÃ´ng cÃ³ bÃ i viáº¿t nÃ o trong danh má»¥c nÃ y.</p>';
    return;
  }
  
  container.innerHTML = filteredNews.map(post => `
    <div class="news-card" onclick="showPostDetailNew(${post.id})">
      <div class="news-card-content">
        <h3 class="news-card-title">${post.title}</h3>
        <p class="news-card-excerpt">${post.excerpt}</p>
        <div class="news-card-meta">
          <span>ğŸ“… ${post.date}</span>
          <span>ğŸ‘ï¸ ${post.views}</span>
        </div>
      </div>
    </div>
  `).join('');
}

function renderRelatedPosts() {
  const listContainer = document.getElementById('related-posts-list');
  const inlineContainer = document.getElementById('related-posts-inline');
  const containers = [listContainer, inlineContainer].filter(Boolean);
  if (!containers.length) return;

  // Load latest views from localStorage
  loadAllViewsFromLocalStorage();

  // Use filtered news for related posts (respecting category selection)
  // Do NOT exclude highlight posts - show all posts in the filtered category
  const base = filteredNews;
  if (!base.length) {
    containers.forEach(el => el.innerHTML = '<p style="color:#9ca3af;font-size:0.9rem;">ChÆ°a cÃ³ bÃ i viáº¿t liÃªn quan.</p>');
    return;
  }

  const related = base.slice(0, 5);
  const html = related.map(post => `
    <div class="related-item" onclick="showPostDetailNew(${post.id})">
      <div class="related-item-title">${post.title}</div>
      <div class="related-item-date">ğŸ“… ${post.date}</div>
    </div>
  `).join('');

  containers.forEach(el => el.innerHTML = html);
}

// ============ Helper Functions ============
function getCategoryLabel(category) {
  const categoryNames = {
    knowledge: 'ğŸŒ¾ Kiáº¿n Thá»©c CÆ¡ Báº£n',
    techniques: 'ğŸŒ± Ká»¹ Thuáº­t Canh TÃ¡c',
    experience: 'ğŸ’¡ Kinh Nghiá»‡m NÃ´ng DÃ¢n',
    benefits: 'ğŸŒ Lá»£i Ãch & MÃ´i TrÆ°á»ng',
    other: 'ğŸ“‚ KhÃ¡c'
  };
  return categoryNames[category] || 'ğŸ“‚ KhÃ¡c';
}

// ============ Category Filtering ============
function filterByCategory(category) {
  // BÆ°á»›c 1: Quay vá» danh sÃ¡ch tin tá»©c (thoÃ¡t khá»i detail view náº¿u Ä‘ang xem)
  const listView = document.querySelector('.news-list-view');
  const detailView = document.querySelector('.news-detail-view');
  
  if (detailView && !detailView.classList.contains('hidden')) {
    detailView.classList.add('hidden');
    detailView.classList.remove('visible');
  }
  
  if (listView && !listView.classList.contains('visible')) {
    listView.classList.remove('hidden');
    listView.classList.add('visible');
  }
  
  // BÆ°á»›c 2: Filter ná»™i dung theo category
  currentCategory = category;
  
  // Update active button
  document.querySelectorAll('.category-tag').forEach(btn => {
    btn.classList.remove('active');
    if (btn.getAttribute('data-category') === category) {
      btn.classList.add('active');
    }
  });
  
  // Filter news - Support multi-category posts
  const highlightSection = document.getElementById('news-highlight');
  const tipCard = document.getElementById('tip-card');
  
  if (category === 'all') {
    filteredNews = [...mockNewsData];
    const titleEl = document.getElementById('category-title');
    const newsTitleEl = document.getElementById('news-section-title');
    const highlightLabelEl = document.getElementById('news-highlight-label');
    if (titleEl) titleEl.textContent = 'ğŸ“š Táº¥t Cáº£ BÃ i Viáº¿t';
    if (newsTitleEl) newsTitleEl.textContent = 'ğŸ“š Táº¥t Cáº£ BÃ i Viáº¿t';
    if (highlightLabelEl) highlightLabelEl.textContent = 'Tin Má»›i Nháº¥t';
    
    // Hide highlight section and tip card when viewing all (like filtering)
    if (highlightSection) highlightSection.style.display = 'none';
    if (tipCard) tipCard.style.display = 'none';
  } else {
    // Filter posts that have the selected category in their categories array
    filteredNews = mockNewsData.filter(post => post.categories && post.categories.includes(category));
    const categoryNames = {
      knowledge: 'ğŸŒ¾ Kiáº¿n Thá»©c CÆ¡ Báº£n',
      techniques: 'ğŸŒ± Ká»¹ Thuáº­t',
      experience: 'ğŸ’¡ Kinh Nghiá»‡m',
      benefits: 'ğŸŒ Lá»£i Ãch & MÃ´i TrÆ°á»ng',
      other: 'ğŸ“‚ KhÃ¡c'
    };
    const titleEl = document.getElementById('category-title');
    const newsTitleEl = document.getElementById('news-section-title');
    const highlightLabelEl = document.getElementById('news-highlight-label');
    const label = categoryNames[category] || 'BÃ i Viáº¿t';
    const plainLabel = label.replace(/^[^\s]+\s*/, '').trim() || label;
    if (titleEl) titleEl.textContent = label;
    if (newsTitleEl) newsTitleEl.textContent = `ğŸ“š ${plainLabel}`;
    if (highlightLabelEl) highlightLabelEl.textContent = 'Tin Má»›i Nháº¥t';
    
    // Hide RED blocks: highlight section AND tip card (keep related posts visible)
    // Related posts will move to top, Left and Results columns stay visible
    if (highlightSection) highlightSection.style.display = 'none';
    if (tipCard) tipCard.style.display = 'none';
  }
  
  renderNewsList();   // Shows filtered by category
  renderCategoryPosts();
  renderRelatedPosts(); // Shows related to filtered category
}

// ============ View Tracking with localStorage ============
function incrementPostView(postId) {
  // Get views from localStorage
  let postViews = JSON.parse(localStorage.getItem('postViews') || '{}');
  
  // Increment view count
  postViews[postId] = (postViews[postId] || 0) + 1;
  
  // Save back to localStorage
  localStorage.setItem('postViews', JSON.stringify(postViews));
  
  // Update mockNewsData
  const post = mockNewsData.find(p => p.id === postId);
  if (post) {
    post.views = postViews[postId];
  }
  
  return postViews[postId];
}

function getPostView(postId) {
  const postViews = JSON.parse(localStorage.getItem('postViews') || '{}');
  return postViews[postId] || 0;
}

function loadAllViewsFromLocalStorage() {
  const postViews = JSON.parse(localStorage.getItem('postViews') || '{}');
  mockNewsData.forEach(post => {
    post.views = postViews[post.id] || 0;
  });
}

function updateCardViews(postId, newViews) {
  // Update all cards displaying this post (in list, highlights, related, etc.)
  const cards = document.querySelectorAll(`[onclick*="showPostDetailNew(${postId})"]`);
  
  cards.forEach(card => {
    // Find all spans in the card
    const allSpans = card.querySelectorAll('span');
    allSpans.forEach(span => {
      const text = span.textContent || '';
      if (text.includes('ğŸ‘ï¸') && text.includes('lÆ°á»£t xem')) {
        span.textContent = `ğŸ‘ï¸ ${newViews} lÆ°á»£t xem`;
      }
    });
  });
  
  console.log(`âœ… Updated views for post ${postId} in ${cards.length} card(s)`);
}

// ============ New Post Detail View (12-column layout) ============
function showPostDetailNew(postId) {
  const post = mockNewsData.find(p => p.id === postId);
  if (!post) return;
  
  // Increment view count
  const newViews = incrementPostView(postId);
  
  // Update the view count in the card IMMEDIATELY (before hiding)
  updateCardViews(postId, newViews);
  
  // Mark as read in localStorage
  let readPosts = JSON.parse(localStorage.getItem('readPosts') || '[]');
  if (!readPosts.includes(postId)) {
    readPosts.push(postId);
    localStorage.setItem('readPosts', JSON.stringify(readPosts));
  }
  
  // Mark current active post
  localStorage.setItem('activePost', postId);
  
  // Update related posts styling
  updateRelatedPostsStyles();
  
  // Hide list, show detail with fade
  const listView = document.getElementById('news-list-view');
  const detailView = document.getElementById('news-detail-view');
  
  listView.classList.remove('visible');
  listView.classList.add('hidden');
  
  setTimeout(() => {
    detailView.classList.remove('hidden');
    detailView.classList.add('visible');
  }, 300);
  
  // Populate content
  document.getElementById('post-title-new').textContent = post.title;
  document.getElementById('post-date-new').textContent = 'ğŸ“… ' + post.date;
  document.getElementById('post-category-new').textContent = 'ğŸ“ ' + post.categoryName;
  document.getElementById('post-views-new').textContent = 'ğŸ‘ï¸ ' + newViews + ' lÆ°á»£t xem';
  document.getElementById('post-content-new').innerHTML = post.content;
  const galleryEl = document.getElementById('post-gallery');
  if (galleryEl) {
    if (post.images && post.images.length) {
      galleryEl.innerHTML = post.images.map(img => `
        <img src="${img}" alt="${post.title}" onerror="this.style.display='none'">
      `).join('');
      galleryEl.style.display = 'grid';
    } else {
      galleryEl.innerHTML = '';
      galleryEl.style.display = 'none';
    }
  }
  
  // Scroll to detail view content (not page top) after transition
  setTimeout(() => {
    detailView.scrollIntoView({behavior: 'smooth', block: 'start'});
  }, 350);
}

function closePostDetailNew() {
  const listView = document.getElementById('news-list-view');
  const detailView = document.getElementById('news-detail-view');
  
  detailView.classList.remove('visible');
  detailView.classList.add('hidden');
  
  setTimeout(() => {
    listView.classList.remove('hidden');
    listView.classList.add('visible');
  }, 300);
  
  // Clear active post
  localStorage.removeItem('activePost');
  
  // Re-render list with updated views
  renderNewsList();
  
  // Filter to show all posts (same as clicking "Táº¥t Cáº£" menu)
  filterByCategory('all');
  
  // Scroll to news list section
  setTimeout(() => {
    const newsListView = document.getElementById('news-list-view');
    if (newsListView) {
      newsListView.scrollIntoView({behavior: 'smooth', block: 'start'});
    }
  }, 350);
  
  const galleryEl = document.getElementById('post-gallery');
  if (galleryEl) {
    galleryEl.innerHTML = '';
    galleryEl.style.display = 'none';
  }
}

// ============ Post Detail View (old - kept for compatibility) ============
function showPostDetail(postId) {
  const post = mockNewsData.find(p => p.id === postId);
  if (!post) return;
  
  // Hide sections
  const sectionNewest = document.getElementById('section-newest');
  const sectionCategory = document.getElementById('section-category');
  if (sectionNewest) sectionNewest.style.display = 'none';
  if (sectionCategory) sectionCategory.style.display = 'none';
  
  // Show detail
  const detailView = document.getElementById('post-detail-view');
  if (detailView) detailView.classList.add('active');
  
  // Populate content
  const titleEl = document.getElementById('post-title');
  const dateEl = document.getElementById('post-date');
  const categoryEl = document.getElementById('post-category');
  const viewsEl = document.getElementById('post-views');
  const contentEl = document.getElementById('post-content');
  
  if (titleEl) titleEl.textContent = post.title;
  if (dateEl) dateEl.textContent = 'ğŸ“… ' + post.date;
  if (categoryEl) categoryEl.textContent = 'ğŸ“ ' + post.categoryName;
  if (viewsEl) viewsEl.textContent = 'ğŸ‘ï¸ ' + post.views + ' lÆ°á»£t xem';
  if (contentEl) contentEl.innerHTML = post.content;
  
  // Scroll to detail view to show content immediately
  if (detailView) {
    setTimeout(() => {
      detailView.scrollIntoView({behavior: 'smooth', block: 'start'});
    }, 100);
  }
}

function closePostDetail() {
  document.getElementById('post-detail-view').classList.remove('active');
  document.getElementById('section-newest').style.display = 'grid';
  document.getElementById('section-category').style.display = 'grid';
  
  // Scroll to sections
  document.querySelector('.main-container').scrollIntoView({behavior: 'smooth'});
}

// ============ Interaction Functions ============
function markUseful() {
  const btn = document.getElementById('btn-useful-new');
  if (!btn) return;
  
  const isActive = btn.classList.contains('active');
  
  if (isActive) {
    // Bá» Ä‘Ã¡nh giÃ¡
    btn.classList.remove('active');
    btn.style.background = '#16a34a';
    btn.innerHTML = '<span>ğŸ‘</span><span>Há»¯u Ã­ch</span>';
  } else {
    // ÄÃ¡nh giÃ¡ há»¯u Ã­ch
    btn.classList.add('active');
    btn.style.background = '#15803d';
    btn.innerHTML = '<span>âœ…</span><span>ÄÃ£ Ä‘Ã¡nh giÃ¡</span>';
    alert('âœ… Cáº£m Æ¡n báº¡n Ä‘Ã£ Ä‘Ã¡nh giÃ¡ bÃ i viáº¿t há»¯u Ã­ch!');
  }
}

function savePost() {
  const btn = document.getElementById('btn-save-new');
  if (!btn) return;
  
  const isSaved = btn.classList.contains('saved');
  
  if (isSaved) {
    // ChÆ°a lÆ°u - tráº¡ng thÃ¡i máº·c Ä‘á»‹nh
    btn.classList.remove('saved');
    btn.style.background = '';
    btn.style.color = '';
    btn.style.borderColor = '';
    btn.innerHTML = '<span>ğŸ’¾</span><span>LÆ°u</span>';
  } else {
    // ÄÃ£ lÆ°u - tráº¡ng thÃ¡i active
    btn.classList.add('saved');
    btn.style.background = '#2563eb';
    btn.style.color = 'white';
    btn.style.borderColor = '#1d4ed8';
    btn.innerHTML = '<span>âœ…</span><span>ÄÃ£ lÆ°u</span>';
  }
}

function shareZalo() {
  const url = window.location.href;
  const title = document.getElementById('post-title-new')?.textContent || 'Má»¥n dá»«a HoÃ ng Hiáº¿u';
  window.open(`https://zalo.me/share?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`, '_blank');
}

function shareFacebook() {
  const url = window.location.href;
  window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
}

function copyLink() {
  const url = window.location.href;
  navigator.clipboard.writeText(url).then(() => {
    alert('âœ… ÄÃ£ copy link bÃ i viáº¿t!');
  }).catch(() => {
    alert('âŒ KhÃ´ng thá»ƒ copy link. Vui lÃ²ng thá»­ láº¡i!');
  });
}

// ============ Newsletter Subscription ============
function subscribeNewsletter() {
  const email = document.getElementById('newsletter-email').value;
  if (!email || !email.includes('@')) {
    alert('Vui lÃ²ng nháº­p email há»£p lá»‡!');
    return;
  }
  // TODO: Send to backend API
  alert('Cáº£m Æ¡n báº¡n Ä‘Ã£ Ä‘Äƒng kÃ½ nháº­n tin! ChÃºng tÃ´i sáº½ gá»­i thÃ´ng tin má»›i nháº¥t Ä‘áº¿n: ' + email);
  document.getElementById('newsletter-email').value = '';
}

// ============ Related Posts Rendering ============
function renderRelatedPosts() {
  const container = document.getElementById('related-posts-list');
  if (!container) return;
  
  const readPosts = JSON.parse(localStorage.getItem('readPosts') || '[]');
  const activePost = localStorage.getItem('activePost');
  
  // Take up to 5 posts for related section
  const relatedPosts = filteredNews.slice(0, 5);
  
  container.innerHTML = relatedPosts.map(post => {
    const isActive = post.id === parseInt(activePost);
    const isRead = readPosts.includes(post.id);
    const classes = ['related-item'];
    if (isActive) classes.push('active');
    else if (isRead) classes.push('read');
    
    return `
      <div class="${classes.join(' ')}" onclick="showPostDetailNew(${post.id})">
        <div class="related-item-title">${post.title}</div>
        <div class="related-item-date">ğŸ“… ${post.date}</div>
      </div>
    `;
  }).join('');
}

// Update related posts styles without re-rendering
function updateRelatedPostsStyles() {
  const readPosts = JSON.parse(localStorage.getItem('readPosts') || '[]');
  const activePost = localStorage.getItem('activePost');
  
  document.querySelectorAll('.related-item').forEach(item => {
    const postId = parseInt(item.getAttribute('onclick').match(/\d+/)[0]);
    item.classList.remove('active', 'read');
    
    if (postId === parseInt(activePost)) {
      item.classList.add('active');
    } else if (readPosts.includes(postId)) {
      item.classList.add('read');
    }
  });
}

// ============ Farm Results Image Rotation ============
const farmResults = [
  '/assets/image/gallery/results/cÃ  chua 1.jpg',
  '/assets/image/gallery/results/CÃ  chua.png',
  '/assets/image/gallery/results/dÃ¢u tÃ¢y.png',
  '/assets/image/gallery/results/dÆ°a lÆ°á»›i.png',
  '/assets/image/gallery/results/DÆ°a vÃ ng.png',
  '/assets/image/gallery/results/hoa lan.png',
  '/assets/image/gallery/results/lan tim.png',
  '/assets/image/gallery/results/á»›t chuÃ´ng.png'
];

let currentResultSet = 0; // 0 = first 4, 1 = last 4

function renderResultImages() {
  const container = document.getElementById('results-gallery');
  if (!container) {
    console.error('âŒ results-gallery container not found!');
    return;
  }
  
  const start = currentResultSet * 4;
  const images = farmResults.slice(start, start + 4);
  
  console.log('ğŸ–¼ï¸ Rendering result images:', { start, count: images.length, images });
  
  container.innerHTML = images.map((src, idx) => 
    `<img src="${src}" alt="Káº¿t quáº£ ${start + idx + 1}" class="result-img fade-in" onerror="console.error('Failed to load:', this.src)">`
  ).join('');
}

function rotateResults() {
  const container = document.getElementById('results-gallery');
  if (!container) return;
  
  // Fade out current images
  const imgs = container.querySelectorAll('.result-img');
  imgs.forEach(img => {
    img.classList.remove('fade-in');
    img.classList.add('fade-out');
  });
  
  // After fade out, switch to next set
  setTimeout(() => {
    currentResultSet = (currentResultSet + 1) % 2;
    renderResultImages();
  }, 600);
}

// ============ Search imported from news-search-simple.js ============
/* OLD SEARCH CODE REMOVED - Now using /js/news-search-simple.js 
   Simple search includes only: Posts, Tips, Categories
   No more DOM scanning or complex page content search
*/

// ============ Initialize ============
function initializePage() {
  console.log('ğŸš€ Initializing page...');
  
  // Load views from localStorage FIRST
  console.log('ğŸ“Š Loading views from localStorage...');
  loadAllViewsFromLocalStorage();
  
  // Time and tips - execute immediately
  console.log('â° Setting up time display...');
  updateTopInfoTime();
  setInterval(updateTopInfoTime, 30000);
  
  const tipEl = document.getElementById('top-info-tip');
  console.log('ğŸ’¡ Tip element:', tipEl);
  if(tipEl) {
    tipEl.textContent = tips[0];
    setInterval(rotateTip, 5000);
  }
  
  // Daily tip - execute immediately
  const tipCard = document.getElementById('tip-card');
  const tipContent = document.getElementById('daily-tip-content');
  console.log('ğŸ“ Daily tip elements:', {tipCard, tipContent});
  if (tipCard && tipContent) {
    tipCard.style.display = 'block';
    tipContent.textContent = dailyTips[0];
    console.log('âœ… Daily tip set:', dailyTips[0]);
  } else {
    console.error('âŒ Daily tip elements not found!');
  }
  
  // Quick news
  console.log('ğŸ“° Initializing quick news...');
  initQuickNewsRotator();
  
  // Banner
  initBannerSlider();
  
  // Clear read posts tracking on page load to reset state
  localStorage.removeItem('readPosts');
  localStorage.removeItem('activePost');
  
  // Render content
  try {
    renderNewsList();
  } catch (e) {
    console.error('Error in renderNewsList:', e);
  }
  
  try {
    renderNewestPosts();
  } catch (e) {
    console.error('Error in renderNewestPosts:', e);
  }
  
  try {
    renderCategoryPosts();
  } catch (e) {
    console.error('Error in renderCategoryPosts:', e);
  }
  
  try {
    renderRelatedPosts();
  } catch (e) {
    console.error('Error in renderRelatedPosts:', e);
  }
  
  // Results gallery rotation
  console.log('ğŸ–¼ï¸ Initializing results gallery...');
  renderResultImages();
  setInterval(rotateResults, 12000); // Rotate every 12 seconds
  
  // Category filter listeners
  document.querySelectorAll('.category-tag').forEach(btn => {
    btn.addEventListener('click', () => {
      const category = btn.getAttribute('data-category');
      filterByCategory(category);
    });
  });
}

// Run immediately if DOM is already loaded, otherwise wait for DOMContentLoaded
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializePage);
} else {
  // DOM already loaded
  initializePage();
}
</script>

{# Import Simple Search #}
<script src="/js/news-search-simple.js"></script>

{% endblock %}
