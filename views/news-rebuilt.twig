{% extends 'layout.twig' %}

{% block title %}Tin Tá»©c NÃ´ng Nghiá»‡p - Má»¥n Dá»«a HoÃ ng Hiáº¿u{% endblock %}

{% block head %}
  <meta property="og:title" content="Tin Tá»©c NÃ´ng Nghiá»‡p - Má»¥n Dá»«a HoÃ ng Hiáº¿u">
  <meta property="og:description" content="Cáº­p nháº­t tin tá»©c má»›i nháº¥t vá» ká»¹ thuáº­t trá»“ng cÃ¢y vÃ  nÃ´ng nghiá»‡p bá»n vá»¯ng">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
  
  <style>
    /* Top Info Bar */
    .top-info-bar{background:linear-gradient(135deg,#15803d,#16a34a);color:#fff;padding:0.75rem 0;font-size:0.9rem}
    .top-info-content{width:100%;max-width:1200px;margin:0 auto;padding:0 5%;display:grid;grid-template-columns:auto 1fr 1fr auto;align-items:center;column-gap:2.5rem}
    .info-item{display:flex;align-items:center;gap:0.6rem;flex-shrink:1;min-width:0}
    .info-item span:last-child{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .top-info-content > .info-item:nth-child(2),
    .top-info-content > .info-item:nth-child(3){justify-self:center;max-width:60vw}
    .tip-icon{display:inline-block;margin-right:0.45rem;opacity:0.98}
    .info-quick-news{font-weight:600;font-size:0.95rem;padding:0.4rem 1rem;background:rgba(255,255,255,0.12);border-radius:6px;backdrop-filter:blur(6px);transition:all 0.28s ease;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .info-slogan{font-weight:700;font-size:1rem;text-align:right;white-space:nowrap;padding-right:0.75rem}
    
    /* Hero Banner */
    .hero-banner{position:relative;width:100%;height:500px;overflow:hidden;background:#1a4d2e}
    .swiper-hero{width:100%;height:100%}
    .hero-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(to bottom,rgba(0,0,0,0.4),rgba(0,0,0,0.2));z-index:1;pointer-events:none}
    .hero-content{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:2;text-align:center;width:90%;max-width:800px}
    .hero-title{font-size:3.5rem;font-weight:800;color:#fff;margin-bottom:1rem;text-shadow:2px 2px 8px rgba(0,0,0,0.5);line-height:1.2}
    .hero-subtitle{font-size:1.2rem;color:#f0f0f0;margin-bottom:1.5rem;text-shadow:1px 1px 4px rgba(0,0,0,0.5);line-height:1.6}
    .hero-btn{display:inline-flex;align-items:center;gap:0.5rem;padding:1rem 2rem;background:#16a34a;color:#fff;font-size:1.1rem;font-weight:700;border:none;border-radius:10px;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 12px rgba(0,0,0,0.3)}
    .hero-btn:hover{background:#15803d;transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,0.4)}
    
    /* Category Menu Bar */
    .category-bar{width:100%;background:#f0fdf4;border-top:1px solid rgba(0,0,0,0.06);border-bottom:1px solid rgba(0,0,0,0.04);padding:1rem 0}
    .category-bar-inner{width:100%;padding:0 5%;display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;align-items:center}
    .cat-btn{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;min-width:140px;padding:0.75rem 1.5rem;background:#fff;border:2px solid #e5e7eb;border-radius:12px;cursor:pointer;font-size:0.95rem;font-weight:600;color:#1f2937;transition:all 0.2s ease;box-shadow:0 2px 4px rgba(0,0,0,0.08);white-space:nowrap}
    .cat-btn:hover{background:#dcfce7;border-color:#16a34a;color:#166534;transform:translateY(-2px);box-shadow:0 4px 12px rgba(22,163,74,0.15)}
    .cat-btn.active{background:#16a34a;border-color:#15803d;color:#fff;box-shadow:0 4px 12px rgba(22,163,74,0.2)}
    
    /* Main Layout Container */
    .main-container{max-width:1200px;margin:0 auto;padding:2rem 5%}
    
    /* Section 1: 3 Newest Posts + Tip */
    .section-newest{display:grid;grid-template-columns:2fr 1fr;gap:2rem;margin-bottom:3rem}
    .newest-grid{display:grid;grid-template-columns:repeat(1,1fr);gap:1.5rem}
    
    /* Section 2: Category Posts + Related Sidebar */
    .section-category{display:grid;grid-template-columns:2fr 1fr;gap:2rem;margin-bottom:3rem}
    .category-posts-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem}
    
    /* News Card */
    .news-card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.1);transition:all 0.3s;cursor:pointer;display:flex;flex-direction:column}
    .news-card:hover{transform:translateY(-4px);box-shadow:0 8px 16px rgba(0,0,0,0.15)}
    .news-card-img{width:100%;height:200px;object-fit:cover}
    .news-card-content{padding:1.5rem;flex:1;display:flex;flex-direction:column}
    .news-card-title{font-size:1.1rem;font-weight:700;color:#15803d;margin-bottom:0.75rem;line-height:1.4}
    .news-card-excerpt{font-size:0.9rem;color:#6b7280;line-height:1.6;flex:1}
    .news-card-meta{display:flex;gap:1rem;font-size:0.85rem;color:#9ca3af;margin-top:0.75rem}
    
    /* Tip Card - Máº¹o canh tÃ¡c */
    .tip-card{background:linear-gradient(135deg,#f0fdf4,#dcfce7);border-radius:12px;padding:1.5rem;box-shadow:0 2px 8px rgba(0,0,0,0.1);position:sticky;top:20px}
    .tip-title{font-size:1.25rem;font-weight:700;color:#15803d;margin-bottom:1rem;display:flex;align-items:center;gap:0.5rem}
    .tip-content{font-size:0.95rem;color:#374151;line-height:1.7;padding:1rem;background:#fff;border-radius:8px;margin-bottom:1rem;min-height:150px}
    .tip-nav{display:flex;justify-content:space-between;gap:0.5rem}
    .tip-nav-btn{padding:0.5rem 1rem;background:#fff;border:2px solid #e5e7eb;border-radius:8px;cursor:pointer;font-weight:600;transition:all 0.2s;color:#374151}
    .tip-nav-btn:hover{background:#dcfce7;border-color:#16a34a;color:#16a34a}
    
    /* Related Sidebar */
    .related-card{background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 2px 8px rgba(0,0,0,0.1);position:sticky;top:20px}
    .related-title{font-size:1.1rem;font-weight:700;color:#15803d;margin-bottom:1rem;display:flex;align-items:center;gap:0.5rem}
    .related-item{padding:0.75rem;border-bottom:1px solid #e5e7eb;cursor:pointer;transition:all 0.2s}
    .related-item:last-child{border-bottom:none}
    .related-item:hover{background:#f0fdf4;padding-left:1rem}
    .related-item-title{font-size:0.9rem;font-weight:600;color:#374151;margin-bottom:0.25rem}
    .related-item-date{font-size:0.75rem;color:#9ca3af}
    
    /* Post Detail View */
    .post-detail{background:#fff;border-radius:12px;padding:2rem;box-shadow:0 2px 8px rgba(0,0,0,0.1);margin-top:2rem;display:none}
    .post-detail.active{display:block}
    .back-btn{display:inline-flex;align-items:center;gap:0.5rem;padding:0.75rem 1.5rem;background:#15803d;color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:600;transition:all 0.2s;margin-bottom:1.5rem}
    .back-btn:hover{background:#166534;transform:translateX(-4px)}
    .post-detail-title{font-size:2rem;font-weight:800;color:#15803d;margin-bottom:1rem}
    .post-detail-meta{display:flex;gap:1.5rem;font-size:0.9rem;color:#9ca3af;padding-bottom:1rem;border-bottom:2px solid #e5e7eb;margin-bottom:2rem}
    .post-detail-content{line-height:1.8;color:#374151;font-size:1.05rem}
    .post-detail-content h2{font-size:1.5rem;font-weight:700;color:#15803d;margin:2rem 0 1rem}
    .post-detail-content p{margin-bottom:1rem}
    .post-detail-content ul{list-style:disc;margin-left:2rem;margin-bottom:1rem}
    
    /* Interaction Buttons */
    .interaction-bar{display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;margin-top:2rem;padding-top:2rem;border-top:2px solid #e5e7eb}
    .interaction-btn{display:inline-flex;align-items:center;gap:0.5rem;padding:0.75rem 1.5rem;border-radius:10px;border:2px solid #e5e7eb;background:#fff;cursor:pointer;font-weight:600;transition:all 0.2s;color:#374151}
    .interaction-btn:hover{background:#f0fdf4;border-color:#16a34a;color:#16a34a;transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.1)}
    .interaction-btn.active{background:#16a34a;border-color:#15803d;color:#fff}
    
    /* Fade transitions */
    #quickNews{transition:opacity 0.22s ease-in-out,transform 0.22s ease-in-out}
    #quickNews.quick-fade-out{opacity:0;transform:translateY(-3px)}
    #quickNews.quick-fade-in{opacity:1;transform:translateY(0)}
    
    /* Responsive */
    @media (max-width:768px){
      .top-info-content{grid-template-columns:1fr;gap:0.5rem}
      .hero-banner{height:400px}
      .hero-title{font-size:2rem}
      .hero-subtitle{font-size:1rem}
      .category-bar-inner{padding:0 3%;gap:0.6rem}
      .cat-btn{min-width:120px;padding:0.6rem 1rem;font-size:0.88rem}
      .main-container{padding:1.5rem 3%}
      .section-newest,.section-category{grid-template-columns:1fr}
      .category-posts-grid,.newest-grid{grid-template-columns:1fr}
      .news-card-img{height:160px}
      .tip-card,.related-card{position:static;margin-bottom:2rem}
      .post-detail{padding:1.5rem}
      .post-detail-title{font-size:1.5rem}
    }
  </style>
{% endblock %}

{% block content %}
<!-- Top Info Bar -->
<section class="top-info-bar">
  <div class="top-info-content">
    <div class="info-item">
      <span id="top-info-time">Äang táº£i...</span>
    </div>
    <div class="info-item tip-item">
      <span class="tip-icon">ğŸ’¡</span>
      <span id="top-info-tip">Giá»¯ áº©m cho má»¥n dá»«a trÆ°á»›c khi sá»­ dá»¥ng</span>
    </div>
    <div class="info-item">
      <span id="quickNews" class="info-quick-news">Äang táº£i tin nhanh...</span>
    </div>
    <div class="info-slogan">
      ğŸ’š Äá»“ng hÃ nh cÃ¹ng nhÃ  nÃ´ng - Lan tá»a nÃ´ng nghiá»‡p xanh ğŸŒ¿
    </div>
  </div>
</section>

<!-- Hero Banner -->
<section class="hero-banner">
  <div class="swiper swiper-hero">
    <div class="swiper-wrapper">
      <div class="swiper-slide"><img src="/assets/image/News/Banner/1-dua.jpg" alt="Banner 1" style="width:100%;height:100%;object-fit:cover;"></div>
      <div class="swiper-slide"><img src="/assets/image/News/Banner/2-Dua kho.jpg" alt="Banner 2" style="width:100%;height:100%;object-fit:cover;"></div>
      <div class="swiper-slide"><img src="/assets/image/News/Banner/3-xo-dua.jpg" alt="Banner 3" style="width:100%;height:100%;object-fit:cover;"></div>
      <div class="swiper-slide"><img src="/assets/image/News/Banner/4-Xa chat.jpg" alt="Banner 4" style="width:100%;height:100%;object-fit:cover;"></div>
      <div class="swiper-slide"><img src="/assets/image/News/Banner/5-Nong trai.jpg" alt="Banner 5" style="width:100%;height:100%;object-fit:cover;"></div>
      <div class="swiper-slide"><img src="/assets/image/News/Banner/6-Mam xanh.jpg" alt="Banner 6" style="width:100%;height:100%;object-fit:cover;"></div>
    </div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  </div>
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <h1 class="hero-title">Tin Tá»©c NÃ´ng Nghiá»‡p</h1>
    <p class="hero-subtitle">Cáº­p nháº­t nhá»¯ng thÃ´ng tin má»›i nháº¥t vá» ká»¹ thuáº­t trá»“ng cÃ¢y, chÄƒm sÃ³c vÆ°á»n, vÃ  cÃ¡c giáº£i phÃ¡p nÃ´ng nghiá»‡p bá»n vá»¯ng vá»›i má»¥n dá»«a.</p>
    <button class="hero-btn" onclick="document.querySelector('.main-container').scrollIntoView({behavior:'smooth'})">
      <span>ğŸ“–</span>
      <span>Äá»c Ngay</span>
    </button>
  </div>
</section>

<!-- Full-width Category Menu Bar -->
<nav class="category-bar">
  <div class="category-bar-inner">
    <button class="cat-btn category-tag active" data-category="all">ğŸ“Œ Táº¥t cáº£</button>
    <button class="cat-btn category-tag" data-category="techniques">ğŸŒ± Ká»¹ Thuáº­t</button>
    <button class="cat-btn category-tag" data-category="experience">ğŸ’¡ Kinh Nghiá»‡m</button>
    <button class="cat-btn category-tag" data-category="environment">ğŸŒ MÃ´i TrÆ°á»ng</button>
    <button class="cat-btn category-tag" data-category="other">ğŸ“‚ KhÃ¡c</button>
    <button class="cat-btn category-tag" data-category="sharing">ğŸ“¸ GÃ³c Chia Sáº»</button>
  </div>
</nav>

<!-- Main Content Container -->
<div class="main-container">
  
  <!-- Section 1: 3 Newest Posts (Left) + Máº¹o canh tÃ¡c (Right) -->
  <section class="section-newest" id="section-newest">
    <div>
      <h2 style="font-size:1.75rem;font-weight:700;color:#15803d;margin-bottom:1.5rem;">â­ Tin Má»›i Nháº¥t</h2>
      <div class="newest-grid" id="newest-posts-grid">
        <!-- 3 newest posts will be rendered here by JS -->
      </div>
    </div>
    
    <div class="tip-card">
      <h3 class="tip-title">
        <span>ğŸ’¡</span>
        <span>Máº¹o Canh TÃ¡c HÃ´m Nay</span>
      </h3>
      <div class="tip-content" id="daily-tip-content">
        Äang táº£i máº¹o canh tÃ¡c...
      </div>
      <div class="tip-nav">
        <button class="tip-nav-btn" onclick="previousTip()">â† TrÆ°á»›c</button>
        <button class="tip-nav-btn" onclick="nextTip()">Sau â†’</button>
      </div>
    </div>
  </section>
  
  <!-- Section 2: Category Posts (Left) + Related Titles (Right) -->
  <section class="section-category" id="section-category">
    <div>
      <h2 style="font-size:1.75rem;font-weight:700;color:#15803d;margin-bottom:1.5rem;" id="category-title">ğŸ“š Táº¥t Cáº£ BÃ i Viáº¿t</h2>
      <div class="category-posts-grid" id="category-posts-grid">
        <!-- Category posts will be rendered here by JS -->
      </div>
    </div>
    
    <div class="related-card">
      <h3 class="related-title">
        <span>ğŸ“‹</span>
        <span>BÃ i Viáº¿t LiÃªn Quan</span>
      </h3>
      <div id="related-posts-list">
        <!-- Related posts will be rendered here by JS -->
      </div>
    </div>
  </section>
  
  <!-- Post Detail View (Hidden by default) -->
  <div class="post-detail" id="post-detail-view">
    <button class="back-btn" onclick="closePostDetail()">
      <span>â†</span>
      <span>Quay láº¡i danh sÃ¡ch</span>
    </button>
    
    <article>
      <h1 class="post-detail-title" id="post-title"></h1>
      <div class="post-detail-meta" id="post-meta">
        <span id="post-date"></span>
        <span id="post-category"></span>
        <span id="post-views"></span>
      </div>
      <div class="post-detail-content" id="post-content">
        <!-- Full post content will be rendered here -->
      </div>
    </article>
    
    <!-- Interaction Buttons -->
    <div class="interaction-bar">
      <button class="interaction-btn" id="btn-useful" onclick="markUseful()">
        <span>ğŸ‘</span>
        <span>Há»¯u Ã­ch</span>
      </button>
      <button class="interaction-btn" id="btn-save" onclick="savePost()">
        <span>ğŸ’¾</span>
        <span>LÆ°u</span>
      </button>
      <button class="interaction-btn" onclick="shareZalo()">
        <span>ğŸ’¬</span>
        <span>Zalo</span>
      </button>
      <button class="interaction-btn" onclick="shareFacebook()">
        <span>ğŸ“˜</span>
        <span>Facebook</span>
      </button>
      <button class="interaction-btn" onclick="copyLink()">
        <span>ğŸ”—</span>
        <span>Copy link</span>
      </button>
    </div>
  </div>
  
</div>
{% endblock %}

{% block scripts %}
{% if quickNewsData is defined %}
<script>
  try {
    window.__QUICK_NEWS__ = {{ quickNewsData|raw }};
  } catch (e) {
    console.warn('Error parsing quickNewsData', e);
    window.__QUICK_NEWS__ = null;
  }
</script>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
// ============ Time Display ============
function updateTopInfoTime() {
  const el = document.getElementById('top-info-time');
  if (!el) return;
  const now = new Date();
  const days = ['Chá»§ Nháº­t', 'Thá»© Hai', 'Thá»© Ba', 'Thá»© TÆ°', 'Thá»© NÄƒm', 'Thá»© SÃ¡u', 'Thá»© Báº£y'];
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const day = now.getDate();
  const month = now.getMonth() + 1;
  const year = now.getFullYear();
  el.textContent = `${hours}:${minutes} ${days[now.getDay()]}, ${day}/${month}/${year}`;
}

// ============ Tip Rotation ============
const tips = [
  'Giá»¯ áº©m cho má»¥n dá»«a trÆ°á»›c khi sá»­ dá»¥ng',
  'Xáº£ muá»‘i ká»¹ trÆ°á»›c khi trá»“ng',
  'Phá»‘i trá»™n Ä‘Ãºng tá»‰ lá»‡ theo loáº¡i cÃ¢y',
  'Bá»• sung phÃ¢n bÃ³n Ä‘á»‹nh ká»³',
  'Kiá»ƒm tra Ä‘á»™ pH thÆ°á»ng xuyÃªn'
];
let currentTipIndex = 0;

function rotateTip() {
  const el = document.getElementById('top-info-tip');
  if (!el) return;
  currentTipIndex = (currentTipIndex + 1) % tips.length;
  el.classList.add('quick-fade-out');
  setTimeout(()=>{
    el.textContent = tips[currentTipIndex];
    el.classList.remove('quick-fade-out');
    el.classList.add('quick-fade-in');
    setTimeout(()=>el.classList.remove('quick-fade-in'), 220);
  }, 220);
}

// ============ Daily Tip (Máº¹o canh tÃ¡c) ============
const dailyTips = [
  'Giá»¯ Ä‘á»™ áº©m á»•n Ä‘á»‹nh cho má»¥n dá»«a báº±ng cÃ¡ch phun sÆ°Æ¡ng nháº¹ hÃ ng ngÃ y. Äá»™ áº©m lÃ½ tÆ°á»Ÿng giÃºp rá»… cÃ¢y phÃ¡t triá»ƒn máº¡nh máº½.',
  'Khi sá»­ dá»¥ng má»¥n dá»«a láº§n Ä‘áº§u, ngÃ¢m trong nÆ°á»›c sáº¡ch 30 phÃºt Ä‘á»ƒ loáº¡i bá» muá»‘i dÆ° thá»«a vÃ  táº¡p cháº¥t.',
  'Trá»™n má»¥n dá»«a vá»›i Ä‘áº¥t vÆ°á»n theo tá»‰ lá»‡ 3:1 cho cÃ¢y trá»“ng trong cháº­u Ä‘á»ƒ Ä‘áº£m báº£o thoÃ¡t nÆ°á»›c tá»‘t.',
  'Bá»• sung phÃ¢n bÃ³n há»¯u cÆ¡ má»—i 2 tuáº§n má»™t láº§n Ä‘á»ƒ cung cáº¥p dinh dÆ°á»¡ng cho cÃ¢y trá»“ng trÃªn má»¥n dá»«a.',
  'Kiá»ƒm tra pH cá»§a má»¥n dá»«a Ä‘á»‹nh ká»³. pH lÃ½ tÆ°á»Ÿng nÃªn trong khoáº£ng 5.5-6.5 cho háº§u háº¿t cÃ¡c loáº¡i cÃ¢y.',
  'TrÃ¡nh Ä‘á»ƒ má»¥n dá»«a khÃ´ hoÃ n toÃ n. LuÃ´n duy trÃ¬ Ä‘á»™ áº©m vá»«a pháº£i Ä‘á»ƒ cÃ¢y háº¥p thá»¥ nÆ°á»›c vÃ  dinh dÆ°á»¡ng hiá»‡u quáº£.'
];
let currentDailyTipIndex = 0;

function showDailyTip() {
  const el = document.getElementById('daily-tip-content');
  if (!el) return;
  el.textContent = dailyTips[currentDailyTipIndex];
}

function nextTip() {
  currentDailyTipIndex = (currentDailyTipIndex + 1) % dailyTips.length;
  showDailyTip();
}

function previousTip() {
  currentDailyTipIndex = (currentDailyTipIndex - 1 + dailyTips.length) % dailyTips.length;
  showDailyTip();
}

// ============ Quick News Rotation ============
function initQuickNewsRotator() {
  const el = document.getElementById('quickNews');
  if(!el) return;
  let list = window.__QUICK_NEWS__||[];
  if(!list.length){ el.textContent='ChÆ°a cÃ³ tin nhanh'; return; }
  let idx=-1; 
  const next = ()=>{ 
    idx=(idx+1)%list.length; 
    el.classList.add('quick-fade-out');
    setTimeout(()=>{
      el.textContent = list[idx]; 
      el.classList.remove('quick-fade-out');
      el.classList.add('quick-fade-in');
      setTimeout(()=>el.classList.remove('quick-fade-in'), 220);
    }, 220);
  }; 
  next(); 
  setInterval(next,4000);
}

// ============ Banner Slider ============
function initBannerSlider(){
  if(typeof Swiper==='undefined') return;
  try{
    new Swiper('.swiper-hero', {
      loop:true,
      speed:800,
      effect:'fade',
      autoplay:{delay:5000,disableOnInteraction:false,pauseOnMouseEnter:true},
      navigation:{nextEl:'.swiper-button-next',prevEl:'.swiper-button-prev'},
      pagination:{el:'.swiper-pagination',clickable:true},
      keyboard:{enabled:true}
    });
  }catch(e){console.warn('Swiper init failed',e);}
}

// ============ Mock News Data ============
const mockNewsData = [
  {
    id: 1,
    title: 'LÃ m tháº¿ nÃ o Ä‘á»ƒ phÃ¢n biá»‡t má»¥n dá»«a Ä‘Ã£ xá»­ lÃ½ vÃ  má»¥n dá»«a chÆ°a xá»­ lÃ½',
    excerpt: 'HÆ°á»›ng dáº«n chi tiáº¿t cÃ¡ch nháº­n biáº¿t má»¥n dá»«a Ä‘Ã£ qua xá»­ lÃ½ Ä‘á»ƒ Ä‘áº£m báº£o cháº¥t lÆ°á»£ng cho cÃ¢y trá»“ng...',
    category: 'techniques',
    categoryName: 'Ká»¹ Thuáº­t',
    date: '23/10/2025',
    views: 1250,
    image: '/assets/image/News/1-LÃ m tháº¿ nÃ o Ä‘á»ƒ phÃ¢n biá»‡t má»¥n dá»«a Ä‘Ã£ xá»­ lÃ½ vÃ  má»¥n dá»«a chÆ°a xá»­ lÃ½.txt',
    content: '<h2>Giá»›i thiá»‡u</h2><p>Má»¥n dá»«a lÃ  giÃ¡ thá»ƒ trá»“ng cÃ¢y phá»• biáº¿n trong nÃ´ng nghiá»‡p hiá»‡n Ä‘áº¡i. Viá»‡c phÃ¢n biá»‡t má»¥n dá»«a Ä‘Ã£ xá»­ lÃ½ vÃ  chÆ°a xá»­ lÃ½ ráº¥t quan trá»ng...</p><h2>Äáº·c Ä‘iá»ƒm má»¥n dá»«a Ä‘Ã£ xá»­ lÃ½</h2><p>Má»¥n dá»«a Ä‘Ã£ xá»­ lÃ½ cÃ³ mÃ u nÃ¢u Ä‘á»“ng Ä‘á»u, Ä‘á»™ áº©m á»•n Ä‘á»‹nh khoáº£ng 60-65%, pH tá»« 5.5-6.5...</p><h2>CÃ¡ch kiá»ƒm tra</h2><ul><li>Kiá»ƒm tra mÃ u sáº¯c vÃ  mÃ¹i</li><li>Thá»­ Ä‘á»™ pH báº±ng giáº¥y quá»³</li><li>NgÃ¢m nÆ°á»›c Ä‘á»ƒ xem Ä‘á»™ giá»¯ áº©m</li></ul>'
  },
  {
    id: 2,
    title: 'Nhá»¯ng tÃ¡c dá»¥ng cá»§a xÆ¡ dá»«a Ä‘á»‘i vá»›i cÃ¢y trá»“ng',
    excerpt: 'XÆ¡ dá»«a khÃ´ng chá»‰ giÃºp giá»¯ áº©m mÃ  cÃ²n cáº£i thiá»‡n cáº¥u trÃºc Ä‘áº¥t, tÄƒng cÆ°á»ng há»‡ vi sinh...',
    category: 'experience',
    categoryName: 'Kinh Nghiá»‡m',
    date: '22/10/2025',
    views: 980,
    image: '/assets/image/News/2-Nhá»¯ng tÃ¡c dá»¥ng cá»§a xÆ¡ dá»«a Ä‘á»‘i vá»›i cÃ¢y trá»“ng.txt',
    content: '<h2>Lá»£i Ã­ch cá»§a xÆ¡ dá»«a</h2><p>XÆ¡ dá»«a lÃ  váº­t liá»‡u há»¯u cÆ¡ tuyá»‡t vá»i cho cÃ¢y trá»“ng...</p>'
  },
  {
    id: 3,
    title: 'Má»™t sá»‘ lÆ°u Ã½ khi sá»­ dá»¥ng má»¥n dá»«a',
    excerpt: 'Äá»ƒ tá»‘i Æ°u hiá»‡u quáº£ sá»­ dá»¥ng má»¥n dá»«a, báº¡n cáº§n chÃº Ã½ Ä‘áº¿n Ä‘á»™ áº©m, pH, vÃ  cÃ¡ch trá»™n phá»‘i...',
    category: 'techniques',
    categoryName: 'Ká»¹ Thuáº­t',
    date: '21/10/2025',
    views: 1100,
    image: '/assets/image/News/3-Má»˜T Sá» LÆ¯U Ã 3-KHI Sá»¬ Dá»¤NG Má»¤N Dá»ªA.txt',
    content: '<h2>LÆ°u Ã½ quan trá»ng</h2><p>Khi sá»­ dá»¥ng má»¥n dá»«a cáº§n chÃº Ã½ cÃ¡c Ä‘iá»ƒm sau...</p>'
  },
  {
    id: 4,
    title: 'Má»¥n dá»«a lÃ  gÃ¬ vÃ  táº¡i sao nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng trong trá»“ng cÃ¢y',
    excerpt: 'TÃ¬m hiá»ƒu vá» nguá»“n gá»‘c, Ä‘áº·c tÃ­nh vÃ  á»©ng dá»¥ng cá»§a má»¥n dá»«a trong nÃ´ng nghiá»‡p hiá»‡n Ä‘áº¡i...',
    category: 'other',
    categoryName: 'KhÃ¡c',
    date: '20/10/2025',
    views: 1450,
    image: '/assets/image/News/4-Má»¥n dá»«a lÃ  gÃ¬ vÃ  táº¡i sao nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng trong trá»“ng cÃ¢y.txt',
    content: '<h2>Má»¥n dá»«a lÃ  gÃ¬?</h2><p>Má»¥n dá»«a lÃ  pháº§n xÆ¡ bÃªn trong vá» dá»«a...</p>'
  },
  {
    id: 5,
    title: 'Nhá»¯ng lá»£i Ã­ch cá»§a má»¥n dá»«a cho cÃ¢y trá»“ng vÃ  mÃ´i trÆ°á»ng',
    excerpt: 'Má»¥n dá»«a khÃ´ng chá»‰ tá»‘t cho cÃ¢y trá»“ng mÃ  cÃ²n gÃ³p pháº§n báº£o vá»‡ mÃ´i trÆ°á»ng bá»n vá»¯ng...',
    category: 'environment',
    categoryName: 'MÃ´i TrÆ°á»ng',
    date: '19/10/2025',
    views: 890,
    image: '/assets/image/News/5-Nhá»¯ng lá»£i Ã­ch cá»§a má»¥n dá»«a cho cÃ¢y trá»“ng vÃ  mÃ´i trÆ°á»ng.txt',
    content: '<h2>Lá»£i Ã­ch mÃ´i trÆ°á»ng</h2><p>Sá»­ dá»¥ng má»¥n dá»«a giÃºp giáº£m rÃ¡c tháº£i nÃ´ng nghiá»‡p...</p>'
  }
];

let filteredNews = [...mockNewsData];
let currentCategory = 'all';

// ============ Render Functions ============
function renderNewestPosts() {
  const container = document.getElementById('newest-posts-grid');
  if (!container) return;
  
  const newest = mockNewsData.slice(0, 3);
  container.innerHTML = newest.map(post => `
    <div class="news-card" onclick="showPostDetail(${post.id})">
      <div class="news-card-content">
        <h3 class="news-card-title">${post.title}</h3>
        <p class="news-card-excerpt">${post.excerpt}</p>
        <div class="news-card-meta">
          <span>ğŸ“… ${post.date}</span>
          <span>ğŸ‘ï¸ ${post.views} lÆ°á»£t xem</span>
          <span>ğŸ“ ${post.categoryName}</span>
        </div>
      </div>
    </div>
  `).join('');
}

function renderCategoryPosts() {
  const container = document.getElementById('category-posts-grid');
  if (!container) return;
  
  if (filteredNews.length === 0) {
    container.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#9ca3af;padding:2rem;">KhÃ´ng cÃ³ bÃ i viáº¿t nÃ o trong danh má»¥c nÃ y.</p>';
    return;
  }
  
  container.innerHTML = filteredNews.map(post => `
    <div class="news-card" onclick="showPostDetail(${post.id})">
      <div class="news-card-content">
        <h3 class="news-card-title">${post.title}</h3>
        <p class="news-card-excerpt">${post.excerpt}</p>
        <div class="news-card-meta">
          <span>ğŸ“… ${post.date}</span>
          <span>ğŸ‘ï¸ ${post.views}</span>
        </div>
      </div>
    </div>
  `).join('');
}

function renderRelatedPosts() {
  const container = document.getElementById('related-posts-list');
  if (!container) return;
  
  const related = mockNewsData.slice(0, 5);
  container.innerHTML = related.map(post => `
    <div class="related-item" onclick="showPostDetail(${post.id})">
      <div class="related-item-title">${post.title}</div>
      <div class="related-item-date">ğŸ“… ${post.date}</div>
    </div>
  `).join('');
}

// ============ Category Filtering ============
function filterByCategory(category) {
  currentCategory = category;
  
  // Update active button
  document.querySelectorAll('.category-tag').forEach(btn => {
    btn.classList.remove('active');
    if (btn.getAttribute('data-category') === category) {
      btn.classList.add('active');
    }
  });
  
  // Filter news
  if (category === 'all') {
    filteredNews = [...mockNewsData];
    document.getElementById('category-title').textContent = 'ğŸ“š Táº¥t Cáº£ BÃ i Viáº¿t';
  } else {
    filteredNews = mockNewsData.filter(post => post.category === category);
    const categoryNames = {
      techniques: 'ğŸŒ± Ká»¹ Thuáº­t',
      experience: 'ğŸ’¡ Kinh Nghiá»‡m',
      environment: 'ğŸŒ MÃ´i TrÆ°á»ng',
      other: 'ğŸ“‚ KhÃ¡c',
      sharing: 'ğŸ“¸ GÃ³c Chia Sáº»'
    };
    document.getElementById('category-title').textContent = categoryNames[category] || 'BÃ i Viáº¿t';
  }
  
  renderCategoryPosts();
  renderRelatedPosts();
}

// ============ Post Detail View ============
function showPostDetail(postId) {
  const post = mockNewsData.find(p => p.id === postId);
  if (!post) return;
  
  // Hide sections
  document.getElementById('section-newest').style.display = 'none';
  document.getElementById('section-category').style.display = 'none';
  
  // Show detail
  const detailView = document.getElementById('post-detail-view');
  detailView.classList.add('active');
  
  // Populate content
  document.getElementById('post-title').textContent = post.title;
  document.getElementById('post-date').textContent = 'ğŸ“… ' + post.date;
  document.getElementById('post-category').textContent = 'ğŸ“ ' + post.categoryName;
  document.getElementById('post-views').textContent = 'ğŸ‘ï¸ ' + post.views + ' lÆ°á»£t xem';
  document.getElementById('post-content').innerHTML = post.content;
  
  // Scroll to top
  detailView.scrollIntoView({behavior: 'smooth'});
}

function closePostDetail() {
  document.getElementById('post-detail-view').classList.remove('active');
  document.getElementById('section-newest').style.display = 'grid';
  document.getElementById('section-category').style.display = 'grid';
  
  // Scroll to sections
  document.querySelector('.main-container').scrollIntoView({behavior: 'smooth'});
}

// ============ Interaction Functions ============
function markUseful() {
  const btn = document.getElementById('btn-useful');
  btn.classList.toggle('active');
  if (btn.classList.contains('active')) {
    alert('Cáº£m Æ¡n báº¡n Ä‘Ã£ Ä‘Ã¡nh giÃ¡ bÃ i viáº¿t há»¯u Ã­ch!');
  }
}

function savePost() {
  const btn = document.getElementById('btn-save');
  btn.classList.toggle('active');
  if (btn.classList.contains('active')) {
    alert('ÄÃ£ lÆ°u bÃ i viáº¿t!');
  } else {
    alert('ÄÃ£ bá» lÆ°u bÃ i viáº¿t!');
  }
}

function shareZalo() {
  const url = window.location.href;
  const title = document.getElementById('post-title').textContent;
  window.open(`https://zalo.me/share?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`, '_blank');
}

function shareFacebook() {
  const url = window.location.href;
  window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
}

function copyLink() {
  const url = window.location.href;
  navigator.clipboard.writeText(url).then(() => {
    alert('ÄÃ£ copy link bÃ i viáº¿t!');
  });
}

// ============ Initialize ============
document.addEventListener('DOMContentLoaded', function() {
  // Time and tips
  updateTopInfoTime();
  setInterval(updateTopInfoTime, 30000);
  const tipEl = document.getElementById('top-info-tip');
  if(tipEl) tipEl.textContent = tips[0];
  setInterval(rotateTip, 5000);
  
  // Daily tip
  showDailyTip();
  
  // Quick news
  initQuickNewsRotator();
  
  // Banner
  initBannerSlider();
  
  // Render content
  renderNewestPosts();
  renderCategoryPosts();
  renderRelatedPosts();
  
  // Category filter listeners
  document.querySelectorAll('.category-tag').forEach(btn => {
    btn.addEventListener('click', () => {
      const category = btn.getAttribute('data-category');
      filterByCategory(category);
    });
  });
});
</script>
{% endblock %}
